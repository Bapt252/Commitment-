<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperSmartMatch V2 - Interface Enrichie</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header h1 {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            color: #666;
            -webkit-text-fill-color: #666;
        }

        .status-bar {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            border-radius: 15px;
            color: white;
        }

        .status-item {
            text-align: center;
            flex: 1;
        }

        .status-item h3 {
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .status {
            font-size: 2em;
            font-weight: bold;
        }

        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .test-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            background-clip: padding-box;
            position: relative;
            overflow: hidden;
        }

        .test-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
        }

        .test-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #4ecdc4;
            background-color: #f8ffff;
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: #ff6b6b;
            background-color: #fff5f5;
        }

        .file-input {
            display: none;
        }

        .upload-icon {
            font-size: 3em;
            color: #ddd;
            margin-bottom: 10px;
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .btn-test {
            background: linear-gradient(45deg, #ffecd2, #fcb69f);
            color: #333;
        }

        /* NOUVELLES SECTIONS AM√âLIOR√âES */
        .matching-dashboard {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-bottom: 30px;
        }

        .matching-dashboard h2 {
            color: white;
            margin-bottom: 20px;
        }

        .score-overview {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .score-circle {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto;
        }

        .circle-progress {
            width: 200px;
            height: 200px;
            transform: rotate(-90deg);
        }

        .circle-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.2);
            stroke-width: 20;
        }

        .circle-fill {
            fill: none;
            stroke: #ffd700;
            stroke-width: 20;
            stroke-linecap: round;
            stroke-dasharray: 565.48;
            stroke-dashoffset: 565.48;
            transition: stroke-dashoffset 2s ease-in-out;
        }

        .score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .score-value {
            font-size: 3em;
            font-weight: bold;
            color: #ffd700;
        }

        .score-label {
            font-size: 1.2em;
            color: white;
        }

        .scoring-breakdown {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .breakdown-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(5px);
        }

        .breakdown-score {
            font-size: 2em;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .breakdown-weight {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .breakdown-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .breakdown-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ff6b6b);
            transition: width 1.5s ease-in-out;
            width: 0%;
        }

        .analysis-section {
            grid-column: 1 / -1;
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .analysis-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab-button {
            padding: 15px 30px;
            background: none;
            border: none;
            font-size: 1.1em;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            color: #4ecdc4;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #4ecdc4, #ff6b6b);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .mission-comparison {
            display: grid;
            grid-template-columns: 1fr 100px 1fr;
            gap: 30px;
            align-items: start;
        }

        .mission-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .mission-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .mission-text {
            flex: 1;
            margin-right: 15px;
        }

        .mission-category {
            background: #4ecdc4;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .mission-score {
            background: #ffd700;
            color: #333;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            margin-left: 10px;
        }

        .matching-connector {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px 0;
        }

        .connector-line {
            width: 3px;
            height: 100px;
            background: linear-gradient(180deg, #4ecdc4, #ff6b6b);
            border-radius: 2px;
            position: relative;
        }

        .connector-score {
            background: white;
            border: 3px solid #4ecdc4;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #4ecdc4;
            font-size: 1.2em;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
        }

        .skills-analysis {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .skill-match-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .skill-match-item.perfect { background: #e8f5e8; border-left: 4px solid #4caf50; }
        .skill-match-item.good { background: #fff3e0; border-left: 4px solid #ff9800; }
        .skill-match-item.partial { background: #fff5f5; border-left: 4px solid #f44336; }

        .recommendations-section {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .recommendation-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .recommendation-icon {
            font-size: 2em;
            margin-right: 20px;
            width: 60px;
            text-align: center;
        }

        .recommendation-content h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .recommendation-content p {
            color: #666;
            line-height: 1.6;
        }

        .priority-high { border-left: 5px solid #f44336; }
        .priority-medium { border-left: 5px solid #ff9800; }
        .priority-low { border-left: 5px solid #4caf50; }

        .results-area {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #4ecdc4;
            display: none;
        }

        .json-display {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 15px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4ecdc4;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .file-info {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            border-left: 4px solid #4caf50;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #f44336;
            margin: 10px 0;
        }

        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #4caf50;
            margin: 10px 0;
        }

        .quick-test {
            background: linear-gradient(45deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .quick-test h3 {
            color: #333;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .score-overview {
                grid-template-columns: 1fr;
            }
            
            .scoring-breakdown {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .mission-comparison {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ SuperSmartMatch V2</h1>
            <p>Interface Enrichie - Scoring D√©taill√© & Analyse Intelligente</p>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <h3>CV Parser V2</h3>
                <div class="status" id="cv-status">‚è≥</div>
                <small>Port 5051</small>
            </div>
            <div class="status-item">
                <h3>Job Parser V2</h3>
                <div class="status" id="job-status">‚è≥</div>
                <small>Port 5053</small>
            </div>
            <div class="status-item">
                <h3>Redis Cache</h3>
                <div class="status" id="redis-status">‚úÖ</div>
                <small>Port 6379</small>
            </div>
            <div class="status-item">
                <h3>Scoring V2</h3>
                <div class="status">üéØ</div>
                <small>4 Composants</small>
            </div>
        </div>

        <div class="quick-test">
            <h3>üöÄ Tests Rapides Syst√®me V2</h3>
            <button class="btn btn-test" onclick="runQuickTests()">üîç Health Check Complet</button>
            <button class="btn btn-test" onclick="demonstrateFullMatching()">üéØ D√©monstration Compl√®te</button>
            <button class="btn btn-test" onclick="showSystemInfo()">‚ÑπÔ∏è Infos Syst√®me</button>
        </div>

        <div class="test-grid">
            <div class="test-section">
                <h2>üìÑ Test CV Parser V2</h2>
                <div class="upload-area" onclick="document.getElementById('cv-file').click()" 
                     ondrop="handleDrop(event, 'cv')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <div class="upload-icon">üìÑ</div>
                    <p><strong>Cliquer ou glisser un CV (PDF)</strong></p>
                    <small>Extraction enrichie : exp√©rience, missions, comp√©tences</small>
                </div>
                <input type="file" id="cv-file" class="file-input" accept=".pdf" onchange="handleFileSelect(event, 'cv')">
                
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn" onclick="testCVParser()">üîç Parser CV</button>
                    <button class="btn btn-secondary" onclick="checkCVHealth()">‚ù§Ô∏è Health Check</button>
                    <button class="btn btn-test" onclick="testCVWithSample()">üìã CV √âchantillon</button>
                </div>

                <div id="cv-results" class="results-area">
                    <h3>üìä R√©sultats CV Parser</h3>
                    <div id="cv-content"></div>
                </div>

                <div id="cv-loading" class="loading">
                    <div class="loading-spinner"></div>
                    <p>Parsing CV en cours...</p>
                </div>
            </div>

            <div class="test-section">
                <h2>üíº Test Job Parser V2</h2>
                <div class="upload-area" onclick="document.getElementById('job-file').click()"
                     ondrop="handleDrop(event, 'job')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <div class="upload-icon">üíº</div>
                    <p><strong>Cliquer ou glisser une fiche de poste (PDF)</strong></p>
                    <small>Extraction enrichie : missions, comp√©tences requises</small>
                </div>
                <input type="file" id="job-file" class="file-input" accept=".pdf" onchange="handleFileSelect(event, 'job')">
                
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn" onclick="testJobParser()">üîç Parser Job</button>
                    <button class="btn btn-secondary" onclick="checkJobHealth()">‚ù§Ô∏è Health Check</button>
                    <button class="btn btn-test" onclick="testJobWithSample()">üìã Job √âchantillon</button>
                </div>

                <div id="job-results" class="results-area">
                    <h3>üìä R√©sultats Job Parser</h3>
                    <div id="job-content"></div>
                </div>

                <div id="job-loading" class="loading">
                    <div class="loading-spinner"></div>
                    <p>Parsing Job en cours...</p>
                </div>
            </div>
        </div>

        <!-- NOUVELLE SECTION DASHBOARD DE MATCHING -->
        <div class="test-section matching-dashboard">
            <h2>üéØ Dashboard de Matching SuperSmartMatch V2</h2>
            <p style="margin-bottom: 30px;">Analyse d√©taill√©e du score de compatibilit√© bas√©e sur les vraies donn√©es extraites</p>
            
            <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 30px;">
                <button class="btn btn-test" onclick="calculateDetailedMatching()">üöÄ Calcul Matching D√©taill√©</button>
                <button class="btn btn-test" onclick="demonstrateFullMatching()">üéØ D√©monstration Compl√®te</button>
                <button class="btn btn-test" onclick="exportMatchingReport()">üìä Exporter Rapport</button>
            </div>

            <div class="score-overview" id="score-overview" style="display: none;">
                <div>
                    <h3 style="margin-bottom: 20px; text-align: center;">Score Global</h3>
                    <div class="score-circle">
                        <svg class="circle-progress" viewBox="0 0 200 200">
                            <circle class="circle-bg" cx="100" cy="100" r="90"></circle>
                            <circle class="circle-fill" cx="100" cy="100" r="90" id="score-circle"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="score-value" id="global-score">0%</div>
                            <div class="score-label">Compatibilit√©</div>
                        </div>
                    </div>
                </div>

                <div class="scoring-breakdown">
                    <div class="breakdown-item">
                        <div class="breakdown-score" id="missions-score">0</div>
                        <div class="breakdown-weight">Missions (40%)</div>
                        <div class="breakdown-bar">
                            <div class="breakdown-fill" id="missions-bar"></div>
                        </div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-score" id="skills-score">0</div>
                        <div class="breakdown-weight">Comp√©tences (30%)</div>
                        <div class="breakdown-bar">
                            <div class="breakdown-fill" id="skills-bar"></div>
                        </div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-score" id="experience-score">0</div>
                        <div class="breakdown-weight">Exp√©rience (15%)</div>
                        <div class="breakdown-bar">
                            <div class="breakdown-fill" id="experience-bar"></div>
                        </div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-score" id="quality-score">0</div>
                        <div class="breakdown-weight">Qualit√© (15%)</div>
                        <div class="breakdown-bar">
                            <div class="breakdown-fill" id="quality-bar"></div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center;">
                    <h3 style="margin-bottom: 15px;">Recommandation</h3>
                    <div style="font-size: 1.5em; font-weight: bold;" id="recommendation-text">
                        Analysez un CV et une fiche de poste
                    </div>
                    <div style="margin-top: 10px; font-size: 1.1em; opacity: 0.9;" id="recommendation-detail">
                        Pour obtenir une recommandation d√©taill√©e
                    </div>
                </div>
            </div>
        </div>

        <!-- NOUVELLE SECTION ANALYSE D√âTAILL√âE -->
        <div class="analysis-section" id="detailed-analysis" style="display: none;">
            <h2>üîç Analyse D√©taill√©e du Matching</h2>
            
            <div class="analysis-tabs">
                <button class="tab-button active" onclick="switchTab('missions-tab')">üéØ Missions</button>
                <button class="tab-button" onclick="switchTab('skills-tab')">‚ö° Comp√©tences</button>
                <button class="tab-button" onclick="switchTab('experience-tab')">üìà Exp√©rience</button>
                <button class="tab-button" onclick="switchTab('quality-tab')">‚úÖ Qualit√©</button>
            </div>

            <div id="missions-tab" class="tab-content active">
                <h3 style="margin-bottom: 20px; color: #333;">Comparaison des Missions (40% du score total)</h3>
                <div class="mission-comparison" id="mission-comparison">
                    <div class="mission-list">
                        <h4 style="margin-bottom: 15px; color: #4ecdc4;">Missions du CV</h4>
                        <div id="cv-missions-list">
                            <p style="color: #666; text-align: center; padding: 40px;">Aucun CV analys√©</p>
                        </div>
                    </div>
                    
                    <div class="matching-connector">
                        <div class="connector-line">
                            <div class="connector-score" id="mission-match-score">0%</div>
                        </div>
                    </div>
                    
                    <div class="mission-list">
                        <h4 style="margin-bottom: 15px; color: #ff6b6b;">Missions du Poste</h4>
                        <div id="job-missions-list">
                            <p style="color: #666; text-align: center; padding: 40px;">Aucune fiche de poste analys√©e</p>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h4 style="color: #333; margin-bottom: 15px;">üìä Explication du Scoring Missions</h4>
                    <div id="missions-explanation">
                        <p style="color: #666;">L'analyse des missions sera disponible apr√®s parsing des documents.</p>
                    </div>
                </div>
            </div>

            <div id="skills-tab" class="tab-content">
                <h3 style="margin-bottom: 20px; color: #333;">Analyse des Comp√©tences (30% du score total)</h3>
                <div class="skills-analysis">
                    <div>
                        <h4 style="margin-bottom: 15px; color: #4ecdc4;">Comp√©tences du Candidat</h4>
                        <div id="cv-skills-list">
                            <p style="color: #666; text-align: center; padding: 40px;">Aucun CV analys√©</p>
                        </div>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 15px; color: #ff6b6b;">Comp√©tences Requises</h4>
                        <div id="job-skills-list">
                            <p style="color: #666; text-align: center; padding: 40px;">Aucune fiche de poste analys√©e</p>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h4 style="color: #333; margin-bottom: 15px;">üìä Explication du Scoring Comp√©tences</h4>
                    <div id="skills-explanation">
                        <p style="color: #666;">L'analyse des comp√©tences sera disponible apr√®s parsing des documents.</p>
                    </div>
                </div>
            </div>

            <div id="experience-tab" class="tab-content">
                <h3 style="margin-bottom: 20px; color: #333;">Analyse de l'Exp√©rience (15% du score total)</h3>
                <div id="experience-analysis">
                    <p style="color: #666; text-align: center; padding: 40px;">L'analyse de l'exp√©rience sera disponible apr√®s parsing des documents.</p>
                </div>
            </div>

            <div id="quality-tab" class="tab-content">
                <h3 style="margin-bottom: 20px; color: #333;">Qualit√© des Donn√©es (15% du score total)</h3>
                <div id="quality-analysis">
                    <p style="color: #666; text-align: center; padding: 40px;">L'analyse de la qualit√© sera disponible apr√®s parsing des documents.</p>
                </div>
            </div>
        </div>

        <!-- NOUVELLE SECTION RECOMMANDATIONS -->
        <div class="recommendations-section" id="recommendations-section" style="display: none;">
            <h2 style="color: #333; margin-bottom: 25px;">üí° Recommandations Actionables</h2>
            <div id="recommendations-list">
                <div class="recommendation-item priority-medium">
                    <div class="recommendation-icon">üéØ</div>
                    <div class="recommendation-content">
                        <h4>Analysez des documents pour obtenir des recommandations</h4>
                        <p>Uploadez un CV et une fiche de poste pour g√©n√©rer des recommandations personnalis√©es bas√©es sur l'analyse SuperSmartMatch V2.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="messages"></div>
    </div>

    <script>
        let cvData = null;
        let jobData = null;
        let currentMatchingData = null;

        // V√©rification du statut des services au chargement
        document.addEventListener('DOMContentLoaded', function() {
            checkServicesStatus();
        });

        async function checkServicesStatus() {
            const services = [
                { id: 'cv-status', url: 'http://localhost:5051/health' },
                { id: 'job-status', url: 'http://localhost:5053/health' }
            ];

            for (const service of services) {
                try {
                    const response = await fetch(service.url);
                    if (response.ok) {
                        const data = await response.json();
                        document.getElementById(service.id).textContent = '‚úÖ';
                        document.getElementById(service.id).title = `Service op√©rationnel - ${data.service || 'OK'}`;
                    } else {
                        document.getElementById(service.id).textContent = '‚ùå';
                    }
                } catch (error) {
                    document.getElementById(service.id).textContent = '‚ùå';
                    document.getElementById(service.id).title = `Erreur: ${error.message}`;
                }
            }
        }

        async function runQuickTests() {
            showMessage('üîç Lancement des tests rapides...', 'info');
            
            try {
                const cvResponse = await fetch('http://localhost:5051/health');
                const cvData = await cvResponse.json();
                
                const jobResponse = await fetch('http://localhost:5053/health');
                const jobData = await jobResponse.json();
                
                showMessage(`‚úÖ Tests r√©ussis!\nCV Parser: ${cvData.service} - ${cvData.status}\nJob Parser: ${jobData.service} - ${jobData.status}`, 'success');
                
            } catch (error) {
                showMessage(`‚ùå Erreur lors des tests: ${error.message}`, 'error');
            }
        }

        async function demonstrateFullMatching() {
            showMessage('üéØ D√©monstration compl√®te en cours...', 'info');
            
            // Chargement des donn√©es √©chantillon
            await testCVWithSample();
            setTimeout(async () => {
                await testJobWithSample();
                setTimeout(() => {
                    calculateDetailedMatching();
                }, 1000);
            }, 1000);
        }

        async function testCVWithSample() {
            showLoading('cv');
            
            setTimeout(() => {
                const sampleResult = {
                    candidate_name: "Marie Dupont",
                    professional_experience: [
                        {
                            company: "Comptabilit√© Plus",
                            position: "Assistant Comptable",
                            duration: "3 ans",
                            missions: [
                                {
                                    description: "Facturation clients et suivi des r√®glements",
                                    category: "facturation",
                                    confidence: 0.95
                                },
                                {
                                    description: "Saisie des √©critures comptables dans SAP",
                                    category: "saisie",
                                    confidence: 0.92
                                },
                                {
                                    description: "Contr√¥le et validation des comptes fournisseurs",
                                    category: "controle",
                                    confidence: 0.88
                                },
                                {
                                    description: "√âtablissement des rapports mensuels",
                                    category: "reporting",
                                    confidence: 0.85
                                }
                            ]
                        }
                    ],
                    technical_skills: ["Excel", "SAP", "Ciel", "Sage"],
                    soft_skills: ["Rigueur", "Organisation", "Communication"],
                    experience_years: 3,
                    mission_summary: {
                        total_missions: 4,
                        categories: ["facturation", "saisie", "controle", "reporting"],
                        confidence_avg: 0.90
                    }
                };
                
                cvData = sampleResult;
                showResults('cv', sampleResult);
                hideLoading('cv');
                showMessage('‚úÖ CV √©chantillon pars√© avec succ√®s!', 'success');
            }, 1500);
        }

        async function testJobWithSample() {
            showLoading('job');
            
            setTimeout(() => {
                const sampleResult = {
                    job_title: "Assistant(e) Comptable H/F",
                    missions: [
                        {
                            description: "Gestion compl√®te de la facturation clients",
                            category: "facturation",
                            priority: "high",
                            weight: 0.25
                        },
                        {
                            description: "Saisie des √©critures comptables courantes",
                            category: "saisie",
                            priority: "high", 
                            weight: 0.25
                        },
                        {
                            description: "Contr√¥le et lettrage des comptes",
                            category: "controle",
                            priority: "medium",
                            weight: 0.20
                        },
                        {
                            description: "√âlaboration de reportings mensuels",
                            category: "reporting",
                            priority: "medium",
                            weight: 0.15
                        },
                        {
                            description: "Participation aux cl√¥tures comptables",
                            category: "comptabilite",
                            priority: "low",
                            weight: 0.15
                        }
                    ],
                    requirements: {
                        required_missions: ["facturation", "saisie", "controle"],
                        technical_skills: ["Excel", "Logiciel comptable", "ERP"],
                        experience_level: "2-5 ans",
                        soft_skills: ["Rigueur", "Autonomie"]
                    }
                };
                
                jobData = sampleResult;
                showResults('job', sampleResult);
                hideLoading('job');
                showMessage('‚úÖ Job √©chantillon pars√© avec succ√®s!', 'success');
            }, 1500);
        }

        function calculateDetailedMatching() {
            if (!cvData || !jobData) {
                showMessage('‚ùå Veuillez d\'abord parser un CV et une fiche de poste.', 'error');
                return;
            }

            showMessage('üéØ Calcul du matching d√©taill√©...', 'info');

            // Calcul d√©taill√© du score
            const matchingResult = calculateAdvancedScore(cvData, jobData);
            currentMatchingData = matchingResult;

            // Affichage du dashboard
            displayMatchingDashboard(matchingResult);
            
            // Affichage de l'analyse d√©taill√©e
            displayDetailedAnalysis(matchingResult);
            
            // Affichage des recommandations
            displayRecommendations(matchingResult);

            showMessage('‚úÖ Matching d√©taill√© calcul√© avec succ√®s!', 'success');
        }

        function calculateAdvancedScore(cv, job) {
            // Calcul du score des missions (40%)
            const missionScore = calculateMissionScore(cv, job);
            
            // Calcul du score des comp√©tences (30%)
            const skillsScore = calculateSkillsScore(cv, job);
            
            // Calcul du score d'exp√©rience (15%)
            const experienceScore = calculateExperienceScore(cv, job);
            
            // Calcul du score de qualit√© (15%)
            const qualityScore = calculateQualityScore(cv, job);

            const totalScore = Math.round(
                (missionScore.score * 0.40) + 
                (skillsScore.score * 0.30) + 
                (experienceScore.score * 0.15) + 
                (qualityScore.score * 0.15)
            );

            return {
                total_score: totalScore,
                mission_analysis: missionScore,
                skills_analysis: skillsScore,
                experience_analysis: experienceScore,
                quality_analysis: qualityScore,
                recommendation: generateRecommendation(totalScore),
                detailed_breakdown: {
                    missions: { score: Math.round(missionScore.score * 0.40), weight: 40, details: missionScore },
                    skills: { score: Math.round(skillsScore.score * 0.30), weight: 30, details: skillsScore },
                    experience: { score: Math.round(experienceScore.score * 0.15), weight: 15, details: experienceScore },
                    quality: { score: Math.round(qualityScore.score * 0.15), weight: 15, details: qualityScore }
                }
            };
        }

        function calculateMissionScore(cv, job) {
            const cvMissions = cv.professional_experience[0]?.missions || [];
            const jobMissions = job.missions || [];
            
            const cvCategories = cvMissions.map(m => m.category).filter(c => c);
            const jobCategories = jobMissions.map(m => m.category).filter(c => c);
            
            const matches = cvCategories.filter(cat => jobCategories.includes(cat));
            const coverage = jobCategories.length > 0 ? (matches.length / jobCategories.length) * 100 : 0;
            
            return {
                score: Math.min(coverage, 100),
                cv_missions: cvMissions,
                job_missions: jobMissions,
                matched_categories: matches,
                coverage_rate: coverage,
                explanation: `${matches.length} cat√©gories de missions correspondent sur ${jobCategories.length} requises (${Math.round(coverage)}% de couverture)`
            };
        }

        function calculateSkillsScore(cv, job) {
            const cvSkills = [...(cv.technical_skills || []), ...(cv.soft_skills || [])];
            const jobSkills = [...(job.requirements?.technical_skills || []), ...(job.requirements?.soft_skills || [])];
            
            const normalizedCvSkills = cvSkills.map(s => s.toLowerCase());
            const normalizedJobSkills = jobSkills.map(s => s.toLowerCase());
            
            const exactMatches = normalizedJobSkills.filter(skill => 
                normalizedCvSkills.includes(skill)
            );
            
            const partialMatches = normalizedJobSkills.filter(jobSkill => 
                normalizedCvSkills.some(cvSkill => 
                    cvSkill.includes(jobSkill) || jobSkill.includes(cvSkill)
                )
            ).filter(skill => !exactMatches.includes(skill));
            
            const score = jobSkills.length > 0 ? 
                ((exactMatches.length * 1.0 + partialMatches.length * 0.5) / jobSkills.length) * 100 : 50;
            
            return {
                score: Math.min(score, 100),
                cv_skills: cvSkills,
                job_skills: jobSkills,
                exact_matches: exactMatches,
                partial_matches: partialMatches,
                explanation: `${exactMatches.length} comp√©tences parfaitement align√©es et ${partialMatches.length} partiellement compatibles`
            };
        }

        function calculateExperienceScore(cv, job) {
            const cvExperience = cv.experience_years || 0;
            const requiredExperience = job.requirements?.experience_level || "0-2 ans";
            
            const [minExp, maxExp] = extractExperienceRange(requiredExperience);
            
            let score = 50; // Score de base
            
            if (cvExperience >= minExp && cvExperience <= maxExp + 2) {
                score = 100; // Exp√©rience parfaitement align√©e
            } else if (cvExperience >= minExp) {
                score = 85; // Surqualifi√© mais acceptable
            } else {
                score = Math.max(30, (cvExperience / minExp) * 70); // Sous-qualifi√©
            }
            
            return {
                score: score,
                cv_experience: cvExperience,
                required_experience: requiredExperience,
                explanation: `${cvExperience} ans d'exp√©rience vs ${requiredExperience} requis`
            };
        }

        function calculateQualityScore(cv, job) {
            let score = 0;
            const factors = [];
            
            // Compl√©tude du CV
            if (cv.candidate_name) { score += 20; factors.push("Nom du candidat"); }
            if (cv.professional_experience?.length > 0) { score += 25; factors.push("Exp√©rience professionnelle"); }
            if (cv.technical_skills?.length > 0) { score += 20; factors.push("Comp√©tences techniques"); }
            if (cv.mission_summary?.confidence_avg > 0.8) { score += 20; factors.push("Missions bien d√©taill√©es"); }
            if (cv.professional_experience?.[0]?.missions?.length >= 3) { score += 15; factors.push("Missions d√©taill√©es"); }
            
            return {
                score: Math.min(score, 100),
                quality_factors: factors,
                explanation: `Qualit√© √©valu√©e sur ${factors.length} crit√®res de compl√©tude`
            };
        }

        function extractExperienceRange(expStr) {
            const matches = expStr.match(/(\d+)-(\d+)/);
            if (matches) {
                return [parseInt(matches[1]), parseInt(matches[2])];
            }
            return [0, 2]; // Valeur par d√©faut
        }

        function generateRecommendation(score) {
            if (score >= 85) return "Candidat fortement recommand√©";
            if (score >= 70) return "Candidat recommand√© avec r√©serves";
            if (score >= 50) return "Candidat √† consid√©rer selon contexte";
            return "Candidat non recommand√© pour ce poste";
        }

        function displayMatchingDashboard(data) {
            document.getElementById('score-overview').style.display = 'grid';
            
            // Mise √† jour du score global avec animation
            const globalScore = data.total_score;
            document.getElementById('global-score').textContent = globalScore + '%';
            
            // Animation du cercle de progression
            const circle = document.getElementById('score-circle');
            const circumference = 2 * Math.PI * 90;
            const offset = circumference - (globalScore / 100) * circumference;
            circle.style.strokeDashoffset = offset;
            
            // Mise √† jour des scores d√©taill√©s avec animations
            setTimeout(() => {
                document.getElementById('missions-score').textContent = data.detailed_breakdown.missions.score;
                document.getElementById('missions-bar').style.width = (data.mission_analysis.score * 0.4) + '%';
                
                document.getElementById('skills-score').textContent = data.detailed_breakdown.skills.score;
                document.getElementById('skills-bar').style.width = (data.skills_analysis.score * 0.3) + '%';
                
                document.getElementById('experience-score').textContent = data.detailed_breakdown.experience.score;
                document.getElementById('experience-bar').style.width = (data.experience_analysis.score * 0.15) + '%';
                
                document.getElementById('quality-score').textContent = data.detailed_breakdown.quality.score;
                document.getElementById('quality-bar').style.width = (data.quality_analysis.score * 0.15) + '%';
            }, 500);
            
            // Mise √† jour de la recommandation
            document.getElementById('recommendation-text').textContent = data.recommendation;
            document.getElementById('recommendation-detail').textContent = 
                `Score bas√© sur l'analyse de ${data.mission_analysis.cv_missions.length} missions CV et ${data.mission_analysis.job_missions.length} missions requises`;
        }

        function displayDetailedAnalysis(data) {
            document.getElementById('detailed-analysis').style.display = 'block';
            
            // Affichage des missions
            displayMissionAnalysis(data);
            
            // Affichage des comp√©tences
            displaySkillsAnalysis(data);
            
            // Affichage de l'exp√©rience
            displayExperienceAnalysis(data);
            
            // Affichage de la qualit√©
            displayQualityAnalysis(data);
        }

        function displayMissionAnalysis(data) {
            const cvMissionsList = document.getElementById('cv-missions-list');
            const jobMissionsList = document.getElementById('job-missions-list');
            const matchScore = document.getElementById('mission-match-score');
            const explanation = document.getElementById('missions-explanation');
            
            // Missions du CV
            cvMissionsList.innerHTML = data.mission_analysis.cv_missions.map(mission => `
                <div class="mission-item">
                    <div class="mission-text">${mission.description}</div>
                    <div class="mission-category">${mission.category}</div>
                    <div class="mission-score">${Math.round(mission.confidence * 100)}%</div>
                </div>
            `).join('');
            
            // Missions du job
            jobMissionsList.innerHTML = data.mission_analysis.job_missions.map(mission => `
                <div class="mission-item">
                    <div class="mission-text">${mission.description}</div>
                    <div class="mission-category">${mission.category}</div>
                    <div class="mission-score">${mission.priority}</div>
                </div>
            `).join('');
            
            // Score de matching
            matchScore.textContent = Math.round(data.mission_analysis.coverage_rate) + '%';
            
            // Explication
            explanation.innerHTML = `
                <p><strong>Analyse des missions :</strong> ${data.mission_analysis.explanation}</p>
                <p><strong>Cat√©gories correspondantes :</strong> ${data.mission_analysis.matched_categories.join(', ')}</p>
                <p><strong>Impact sur le score :</strong> ${data.detailed_breakdown.missions.score} points sur 40 possibles (${data.detailed_breakdown.missions.weight}% du score total)</p>
            `;
        }

        function displaySkillsAnalysis(data) {
            const cvSkillsList = document.getElementById('cv-skills-list');
            const jobSkillsList = document.getElementById('job-skills-list');
            const explanation = document.getElementById('skills-explanation');
            
            // Comp√©tences du CV
            cvSkillsList.innerHTML = data.skills_analysis.cv_skills.map(skill => {
                const matchType = data.skills_analysis.exact_matches.includes(skill.toLowerCase()) ? 'perfect' :
                               data.skills_analysis.partial_matches.includes(skill.toLowerCase()) ? 'good' : 'partial';
                return `<div class="skill-match-item ${matchType}">${skill}</div>`;
            }).join('');
            
            // Comp√©tences requises
            jobSkillsList.innerHTML = data.skills_analysis.job_skills.map(skill => {
                const matchType = data.skills_analysis.exact_matches.includes(skill.toLowerCase()) ? 'perfect' :
                               data.skills_analysis.partial_matches.includes(skill.toLowerCase()) ? 'good' : 'partial';
                return `<div class="skill-match-item ${matchType}">${skill}</div>`;
            }).join('');
            
            // Explication
            explanation.innerHTML = `
                <p><strong>Analyse des comp√©tences :</strong> ${data.skills_analysis.explanation}</p>
                <p><strong>Comp√©tences exactes :</strong> ${data.skills_analysis.exact_matches.join(', ') || 'Aucune'}</p>
                <p><strong>Comp√©tences partielles :</strong> ${data.skills_analysis.partial_matches.join(', ') || 'Aucune'}</p>
                <p><strong>Impact sur le score :</strong> ${data.detailed_breakdown.skills.score} points sur 30 possibles (${data.detailed_breakdown.skills.weight}% du score total)</p>
            `;
        }

        function displayExperienceAnalysis(data) {
            document.getElementById('experience-analysis').innerHTML = `
                <div style="padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h4 style="color: #333; margin-bottom: 15px;">üìà Analyse de l'Exp√©rience</h4>
                    <p><strong>Exp√©rience du candidat :</strong> ${data.experience_analysis.cv_experience} ans</p>
                    <p><strong>Exp√©rience requise :</strong> ${data.experience_analysis.required_experience}</p>
                    <p><strong>√âvaluation :</strong> ${data.experience_analysis.explanation}</p>
                    <p><strong>Score obtenu :</strong> ${Math.round(data.experience_analysis.score)}%</p>
                    <p><strong>Impact sur le score :</strong> ${data.detailed_breakdown.experience.score} points sur 15 possibles (${data.detailed_breakdown.experience.weight}% du score total)</p>
                </div>
            `;
        }

        function displayQualityAnalysis(data) {
            document.getElementById('quality-analysis').innerHTML = `
                <div style="padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h4 style="color: #333; margin-bottom: 15px;">‚úÖ Analyse de la Qualit√©</h4>
                    <p><strong>Facteurs de qualit√© identifi√©s :</strong></p>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        ${data.quality_analysis.quality_factors.map(factor => `<li>${factor}</li>`).join('')}
                    </ul>
                    <p><strong>√âvaluation :</strong> ${data.quality_analysis.explanation}</p>
                    <p><strong>Score obtenu :</strong> ${Math.round(data.quality_analysis.score)}%</p>
                    <p><strong>Impact sur le score :</strong> ${data.detailed_breakdown.quality.score} points sur 15 possibles (${data.detailed_breakdown.quality.weight}% du score total)</p>
                </div>
            `;
        }

        function displayRecommendations(data) {
            document.getElementById('recommendations-section').style.display = 'block';
            
            const recommendations = generateActionableRecommendations(data);
            const recommendationsList = document.getElementById('recommendations-list');
            
            recommendationsList.innerHTML = recommendations.map(rec => `
                <div class="recommendation-item priority-${rec.priority}">
                    <div class="recommendation-icon">${rec.icon}</div>
                    <div class="recommendation-content">
                        <h4>${rec.title}</h4>
                        <p>${rec.description}</p>
                    </div>
                </div>
            `).join('');
        }

        function generateActionableRecommendations(data) {
            const recommendations = [];
            
            // Recommandations bas√©es sur le score global
            if (data.total_score >= 85) {
                recommendations.push({
                    icon: 'üéØ',
                    title: 'Candidat Excellent - Recommand√© pour Entretien',
                    description: 'Ce candidat pr√©sente un profil exceptionnel avec une tr√®s forte compatibilit√©. Planifiez un entretien rapidement.',
                    priority: 'high'
                });
            } else if (data.total_score >= 70) {
                recommendations.push({
                    icon: 'üë•',
                    title: 'Candidat Prometteur - Entretien Recommand√©',
                    description: 'Profil int√©ressant avec quelques points √† clarifier en entretien. Bon potentiel d\'adaptation.',
                    priority: 'medium'
                });
            }
            
            // Recommandations bas√©es sur les missions
            if (data.mission_analysis.coverage_rate < 60) {
                recommendations.push({
                    icon: 'üìã',
                    title: '√âcart sur les Missions - Formation N√©cessaire',
                    description: `Seulement ${Math.round(data.mission_analysis.coverage_rate)}% des missions sont couvertes. Pr√©voir une formation sur : ${data.mission_analysis.job_missions.filter(jm => !data.mission_analysis.matched_categories.includes(jm.category)).map(jm => jm.category).join(', ')}.`,
                    priority: 'high'
                });
            }
            
            // Recommandations bas√©es sur les comp√©tences
            if (data.skills_analysis.exact_matches.length < data.skills_analysis.job_skills.length * 0.5) {
                recommendations.push({
                    icon: 'üîß',
                    title: 'D√©veloppement des Comp√©tences Techniques',
                    description: `Comp√©tences √† d√©velopper : ${data.skills_analysis.job_skills.filter(skill => !data.skills_analysis.exact_matches.includes(skill.toLowerCase())).join(', ')}.`,
                    priority: 'medium'
                });
            }
            
            // Recommandations sur l'exp√©rience
            if (data.experience_analysis.score < 70) {
                recommendations.push({
                    icon: 'üìà',
                    title: 'Exp√©rience √† Valider',
                    description: 'L\'exp√©rience du candidat ne correspond pas exactement aux attentes. √âvaluer la qualit√© de l\'exp√©rience en entretien.',
                    priority: 'medium'
                });
            }
            
            // Recommandation positive par d√©faut
            if (recommendations.length === 0) {
                recommendations.push({
                    icon: '‚úÖ',
                    title: 'Profil √âquilibr√©',
                    description: 'Le candidat pr√©sente un profil bien √©quilibr√© sur tous les crit√®res d\'√©valuation.',
                    priority: 'low'
                });
            }
            
            return recommendations;
        }

        function switchTab(tabId) {
            // D√©sactiver tous les onglets
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Activer l'onglet s√©lectionn√©
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        function exportMatchingReport() {
            if (!currentMatchingData) {
                showMessage('‚ùå Aucune analyse disponible √† exporter.', 'error');
                return;
            }
            
            const report = {
                timestamp: new Date().toISOString(),
                candidate: cvData?.candidate_name || 'Candidat √âchantillon',
                job_title: jobData?.job_title || 'Poste √âchantillon',
                matching_analysis: currentMatchingData,
                version: 'SuperSmartMatch V2'
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `SuperSmartMatch_Report_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showMessage('üìä Rapport export√© avec succ√®s!', 'success');
        }

        function showSystemInfo() {
            const info = {
                version: "SuperSmartMatch V2 - Interface Enrichie",
                scoring_algorithm: {
                    missions: "40% - Analyse par cat√©gories enrichies",
                    competences: "30% - Matching s√©mantique exact + partiel",
                    experience: "15% - Ann√©es + ad√©quation contexte",
                    qualite: "15% - Compl√©tude et fiabilit√© des donn√©es"
                },
                categories_missions: [
                    "facturation", "saisie", "controle", 
                    "reporting", "gestion", "comptabilite",
                    "commercial", "rh"
                ],
                nouvelles_fonctionnalites: [
                    "Dashboard de scoring visuel",
                    "Analyse d√©taill√©e par composant",
                    "Recommandations actionables",
                    "Explications du calcul de score",
                    "Export de rapports d√©taill√©s"
                ],
                endpoints: {
                    cv_parser: "http://localhost:5051",
                    job_parser: "http://localhost:5053",
                    redis: "localhost:6379"
                }
            };
            
            showResults('cv', info);
            showMessage('‚ÑπÔ∏è Informations syst√®me V2 affich√©es', 'info');
        }

        // Fonctions utilitaires (conserv√©es de l'interface originale)
        function handleDrop(event, type) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0], type);
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }

        function handleFileSelect(event, type) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file, type);
            }
        }

        function handleFile(file, type) {
            if (file.type !== 'application/pdf') {
                showMessage(`Seuls les fichiers PDF sont accept√©s pour le ${type}.`, 'error');
                return;
            }

            const maxSize = 10 * 1024 * 1024; // 10MB
            if (file.size > maxSize) {
                showMessage('Le fichier est trop volumineux (max 10MB).', 'error');
                return;
            }

            const infoDiv = document.createElement('div');
            infoDiv.className = 'file-info';
            infoDiv.innerHTML = `
                <strong>Fichier s√©lectionn√©:</strong> ${file.name}<br>
                <strong>Taille:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB<br>
                <strong>Type:</strong> ${type === 'cv' ? 'CV' : 'Fiche de poste'}
            `;

            const uploadArea = document.querySelector(`#${type}-file`).parentElement.querySelector('.upload-area');
            const existingInfo = uploadArea.parentElement.querySelector('.file-info');
            if (existingInfo) {
                existingInfo.remove();
            }
            uploadArea.parentElement.appendChild(infoDiv);

            if (type === 'cv') {
                window.selectedCVFile = file;
            } else {
                window.selectedJobFile = file;
            }
        }

        async function testCVParser() {
            if (!window.selectedCVFile) {
                showMessage('Veuillez d\'abord s√©lectionner un fichier CV.', 'error');
                return;
            }

            showLoading('cv');
            
            const formData = new FormData();
            formData.append('file', window.selectedCVFile);
            formData.append('force_refresh', 'false');

            try {
                const response = await fetch('http://localhost:5051/api/parse-cv/', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }

                const data = await response.json();
                cvData = data;
                showResults('cv', data);
                showMessage('‚úÖ CV pars√© avec succ√®s! Missions extraites.', 'success');
                
            } catch (error) {
                showMessage(`‚ùå Erreur lors du parsing du CV: ${error.message}`, 'error');
            } finally {
                hideLoading('cv');
            }
        }

        async function testJobParser() {
            if (!window.selectedJobFile) {
                showMessage('Veuillez d\'abord s√©lectionner un fichier de fiche de poste.', 'error');
                return;
            }

            showLoading('job');
            
            const formData = new FormData();
            formData.append('file', window.selectedJobFile);
            formData.append('force_refresh', 'false');

            try {
                const response = await fetch('http://localhost:5053/api/parse-job', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }

                const data = await response.json();
                jobData = data;
                showResults('job', data);
                showMessage('‚úÖ Fiche de poste pars√©e avec succ√®s! Missions extraites.', 'success');
                
            } catch (error) {
                showMessage(`‚ùå Erreur lors du parsing de la fiche de poste: ${error.message}`, 'error');
            } finally {
                hideLoading('job');
            }
        }

        async function checkCVHealth() {
            try {
                const response = await fetch('http://localhost:5051/health');
                const data = await response.json();
                showMessage(`‚úÖ CV Parser V2 Status: ${data.service} - ${data.status}`, 'success');
            } catch (error) {
                showMessage(`‚ùå Erreur health check CV: ${error.message}`, 'error');
            }
        }

        async function checkJobHealth() {
            try {
                const response = await fetch('http://localhost:5053/health');
                const data = await response.json();
                showMessage(`‚úÖ Job Parser V2 Status: ${data.service} - ${data.status}`, 'success');
            } catch (error) {
                showMessage(`‚ùå Erreur health check Job: ${error.message}`, 'error');
            }
        }

        function showLoading(type) {
            document.getElementById(`${type}-loading`).style.display = 'block';
            document.getElementById(`${type}-results`).style.display = 'none';
        }

        function hideLoading(type) {
            document.getElementById(`${type}-loading`).style.display = 'none';
        }

        function showResults(type, data) {
            const resultsDiv = document.getElementById(`${type}-results`);
            const contentDiv = document.getElementById(`${type}-content`);
            
            contentDiv.innerHTML = `<div class="json-display">${JSON.stringify(data, null, 2)}</div>`;
            resultsDiv.style.display = 'block';
        }

        function showMessage(message, type) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.innerHTML = message.replace(/\n/g, '<br>');
            messagesDiv.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>