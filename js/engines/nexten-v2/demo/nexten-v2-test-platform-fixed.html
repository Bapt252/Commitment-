<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXTEN V2.0 - Plateforme de Test R√©el (CORRIG√â)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .test-banner {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            border-bottom: 3px solid #047857;
        }
        
        .fix-banner {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: 600;
            border-bottom: 2px solid #92400e;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 25px;
            padding: 30px;
        }
        
        .test-section {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 2px solid #e5e7eb;
        }
        
        .test-section h2 {
            margin-bottom: 20px;
            color: #374151;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .upload-zone {
            border: 3px dashed #d1d5db;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-zone:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .upload-zone.active {
            border-color: #22c55e;
            background: #dcfce7;
        }
        
        .upload-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            opacity: 0.6;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            font-size: 13px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 13px;
        }
        
        .parsed-data {
            background: #f3f4f6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 11px;
        }
        
        .quick-start {
            background: #fffbeb;
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 20px;
            margin: 20px;
            text-align: center;
        }
        
        .quick-start h3 {
            color: #92400e;
            margin-bottom: 15px;
        }
        
        .hidden { display: none; }
        
        .status-indicator {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .status-success {
            background: #dcfce7;
            color: #166534;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="fix-banner">
            ‚úÖ CORRIG√â: Upload CV/Fiche + Test Pond√©ration Dynamique Int√©gr√©
        </div>
        
        <div class="test-banner">
            üß™ NEXTEN V2.0 + POND√âRATION DYNAMIQUE - Test Platform
        </div>
        
        <div class="header">
            <h1>üß™ NEXTEN V2.0 - Test R√©el</h1>
            <div class="subtitle">Upload CV + Fiche de poste ‚Üí Auto-remplissage ‚Üí Matching avec pond√©ration dynamique</div>
        </div>

        <div class="quick-start">
            <h3>üöÄ Test Rapide - Commencez ici !</h3>
            <button class="btn btn-warning" onclick="loadTestExample()" style="max-width: 300px; margin: 0 auto;">
                üìù CHARGER EXEMPLE DE TEST
            </button>
            <button class="btn btn-success" onclick="testDynamicWeighting()" style="max-width: 300px; margin: 10px auto 0;">
                üéØ TESTER POND√âRATION DYNAMIQUE
            </button>
            <p style="margin-top: 10px; font-size: 14px; color: #666;">
                Charge automatiquement un profil candidat + poste pour tester imm√©diatement
            </p>
        </div>
        
        <div class="main-grid">
            <!-- Section 1: Upload CV -->
            <div class="test-section">
                <h2>üìÑ 1. Upload CV Candidat</h2>
                
                <div class="upload-zone" id="cvUploadZone">
                    <div class="upload-icon">üìÑ</div>
                    <div><strong>Cliquez pour s√©lectionner le CV</strong></div>
                    <div>ou glissez-d√©posez ici</div>
                    <div style="font-size: 11px; margin-top: 10px;">PDF, DOCX, TXT</div>
                </div>
                
                <input type="file" id="cvFile" accept=".pdf,.docx,.txt" style="display: none;">
                
                <div class="form-group">
                    <label>Ou saisie manuelle rapide :</label>
                    <textarea id="cvText" rows="4" placeholder="Nom, exp√©rience, comp√©tences, secteur, salaire souhait√©..."></textarea>
                </div>
                
                <button class="btn" onclick="parseCVData()">üîç Parser CV</button>
                
                <div id="cvParsedData" class="parsed-data hidden">
                    <strong>Donn√©es extraites :</strong>
                    <pre id="cvDataPreview"></pre>
                </div>
                
                <div id="cvStatus" class="hidden">
                    <div class="status-indicator status-success">‚úÖ CV analys√©</div>
                </div>
            </div>
            
            <!-- Section 2: Upload Fiche de Poste -->
            <div class="test-section">
                <h2>üíº 2. Fiche de Poste</h2>
                
                <div class="upload-zone" id="jobUploadZone">
                    <div class="upload-icon">üíº</div>
                    <div><strong>Cliquez pour s√©lectionner la fiche</strong></div>
                    <div>ou glissez-d√©posez ici</div>
                    <div style="font-size: 11px; margin-top: 10px;">PDF, DOCX, TXT</div>
                </div>
                
                <input type="file" id="jobFile" accept=".pdf,.docx,.txt" style="display: none;">
                
                <div class="form-group">
                    <label>Ou saisie manuelle :</label>
                    <textarea id="jobText" rows="4" placeholder="Titre poste, missions, comp√©tences, salaire, secteur, lieu..."></textarea>
                </div>
                
                <button class="btn" onclick="parseJobData()">üîç Parser Fiche</button>
                
                <div id="jobParsedData" class="parsed-data hidden">
                    <strong>Donn√©es extraites :</strong>
                    <pre id="jobDataPreview"></pre>
                </div>
                
                <div id="jobStatus" class="hidden">
                    <div class="status-indicator status-success">‚úÖ Fiche analys√©e</div>
                </div>
            </div>
            
            <!-- Section 3: Test -->
            <div class="test-section">
                <h2>üéØ 3. Test NEXTEN V2.0</h2>
                
                <div class="form-group">
                    <label>Mode de calcul :</label>
                    <select id="nextenConnection">
                        <option value="dynamic">üéØ Pond√©ration Dynamique (Nouveau)</option>
                        <option value="standard">‚öñÔ∏è Pond√©ration Standard V2.0</option>
                        <option value="simulation">üìä Mode Simulation</option>
                    </select>
                </div>
                
                <button class="btn btn-success" onclick="runMatchingTest()" id="matchingBtn">
                    üöÄ LANCER TEST MATCHING
                </button>
                
                <div id="processingStatus" class="hidden" style="text-align: center; padding: 20px;">
                    <div style="border: 3px solid #f3f4f6; border-top: 3px solid #667eea; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 10px;"></div>
                    <div>Calcul en cours...</div>
                </div>
                
                <div id="results" class="hidden" style="background: white; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <h4>üìä R√©sultats</h4>
                    <div id="resultsContent"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Variables globales
        let cvData = null;
        let jobData = null;
        let companyData = null;
        
        // Donn√©es d'exemple pour tests rapides
        const testExamples = {
            cv: {
                nom: "Sophie Martin",
                email: "sophie.martin@email.com",
                pretentions_salariales: "45000-55000",
                experience_annees: 5,
                poste_actuel: "Marketing Manager",
                secteur_actuel: "tech",
                competences: ["Marketing Digital", "Management", "Analytics", "Project Management"],
                motivations: ["remuneration", "localisation", "flexibilite"], // üéØ Pour pond√©ration dynamique
                taille_entreprise_preference: "pme",
                secteurs_cibles: ["tech", "digital"],
                disponibilite: "2_mois",
                coordonnees: {
                    ville: "Paris",
                    adresse: "Paris, France"
                }
            },
            job: {
                titre: "Senior Marketing Manager",
                entreprise: "TechCorp",
                secteur: "tech",
                fourchette_salariale: "50000-60000",
                competences_requises: ["Marketing", "Digital", "Management", "Analytics"],
                type_contrat: "cdi",
                mode_travail: "hybride",
                urgence_recrutement: "normal",
                coordonnees: {
                    ville: "Paris",
                    adresse: "Paris, France"
                }
            },
            company: {
                nom: "TechCorp",
                secteur: "tech",
                effectif: 250,
                localisation: "Paris"
            }
        };
        
        // Style d'animation
        const style = document.createElement('style');
        style.textContent = '@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }';
        document.head.appendChild(style);
        
        // Initialisation SANS conflits
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initialisation de la plateforme de test...');
            setupFileHandlers();
        });
        
        function setupFileHandlers() {
            // Configuration des zones d'upload SANS onclick HTML
            const cvZone = document.getElementById('cvUploadZone');
            const jobZone = document.getElementById('jobUploadZone');
            const cvFile = document.getElementById('cvFile');
            const jobFile = document.getElementById('jobFile');
            
            // CV Upload
            cvZone.addEventListener('click', function(e) {
                e.preventDefault();
                cvFile.click();
            });
            
            cvFile.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    handleCVFile(e.target.files[0]);
                }
            });
            
            // Job Upload
            jobZone.addEventListener('click', function(e) {
                e.preventDefault();
                jobFile.click();
            });
            
            jobFile.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    handleJobFile(e.target.files[0]);
                }
            });
            
            // Drag & Drop
            setupDragAndDrop(cvZone, cvFile, 'cv');
            setupDragAndDrop(jobZone, jobFile, 'job');
            
            console.log('‚úÖ File handlers configur√©s');
        }
        
        function setupDragAndDrop(zone, fileInput, type) {
            zone.addEventListener('dragover', function(e) {
                e.preventDefault();
                zone.classList.add('active');
            });
            
            zone.addEventListener('dragleave', function(e) {
                e.preventDefault();
                zone.classList.remove('active');
            });
            
            zone.addEventListener('drop', function(e) {
                e.preventDefault();
                zone.classList.remove('active');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    if (type === 'cv') {
                        handleCVFile(files[0]);
                    } else {
                        handleJobFile(files[0]);
                    }
                }
            });
        }
        
        async function handleCVFile(file) {
            console.log('üìÑ Traitement CV:', file.name);
            
            try {
                const text = await readFileAsText(file);
                document.getElementById('cvText').value = text.substring(0, 500) + '...';
                parseCVData();
            } catch (error) {
                console.error('Erreur lecture CV:', error);
                alert('Erreur lors de la lecture du fichier CV');
            }
        }
        
        async function handleJobFile(file) {
            console.log('üíº Traitement fiche de poste:', file.name);
            
            try {
                const text = await readFileAsText(file);
                document.getElementById('jobText').value = text.substring(0, 500) + '...';
                parseJobData();
            } catch (error) {
                console.error('Erreur lecture fiche:', error);
                alert('Erreur lors de la lecture du fichier de poste');
            }
        }
        
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }
        
        function parseCVData() {
            const cvText = document.getElementById('cvText').value;
            
            if (!cvText.trim()) {
                alert('Veuillez saisir ou uploader un CV');
                return;
            }
            
            // Extraction intelligente
            cvData = extractCVData(cvText);
            
            // Affichage
            document.getElementById('cvDataPreview').textContent = JSON.stringify(cvData, null, 2);
            document.getElementById('cvParsedData').classList.remove('hidden');
            document.getElementById('cvStatus').classList.remove('hidden');
            
            console.log('‚úÖ CV pars√©:', cvData);
        }
        
        function parseJobData() {
            const jobText = document.getElementById('jobText').value;
            
            if (!jobText.trim()) {
                alert('Veuillez saisir ou uploader une fiche de poste');
                return;
            }
            
            // Extraction intelligente
            const parsed = extractJobData(jobText);
            jobData = parsed.job;
            companyData = parsed.company;
            
            // Affichage
            const combinedData = { job: jobData, company: companyData };
            document.getElementById('jobDataPreview').textContent = JSON.stringify(combinedData, null, 2);
            document.getElementById('jobParsedData').classList.remove('hidden');
            document.getElementById('jobStatus').classList.remove('hidden');
            
            console.log('‚úÖ Fiche pars√©e:', { job: jobData, company: companyData });
        }
        
        function extractCVData(text) {
            const lowerText = text.toLowerCase();
            
            // Extraction patterns
            const salaryMatch = text.match(/(\\d+)[-\\s]*(\\d+)?\\s*k?‚Ç¨?/i);
            const emailMatch = text.match(/[\\w.-]+@[\\w.-]+\\.\\w+/);
            
            // D√©tection secteur
            let secteur = 'tech';
            if (lowerText.includes('marketing')) secteur = 'marketing';
            if (lowerText.includes('finance')) secteur = 'finance';
            if (lowerText.includes('luxe')) secteur = 'luxe';
            
            // Extraction comp√©tences
            const competences = [];
            const skillPatterns = ['marketing', 'management', 'digital', 'analytics', 'javascript', 'python'];
            skillPatterns.forEach(skill => {
                if (lowerText.includes(skill)) {
                    competences.push(skill.charAt(0).toUpperCase() + skill.slice(1));
                }
            });
            
            return {
                nom: extractName(text) || "Candidat Test",
                email: emailMatch ? emailMatch[0] : "candidat@test.com",
                pretentions_salariales: salaryMatch ? `${salaryMatch[1]}-${parseInt(salaryMatch[1]) + 10}k‚Ç¨` : "45000-55000",
                secteur_actuel: secteur,
                competences: competences.length > 0 ? competences : ["Marketing", "Management"],
                motivations: ["remuneration", "localisation", "flexibilite"], // üéØ Pour test pond√©ration dynamique
                coordonnees: { ville: "Paris", adresse: "Paris, France" }
            };
        }
        
        function extractJobData(text) {
            const lowerText = text.toLowerCase();
            const salaryMatch = text.match(/(\\d+)[-\\s]*(\\d+)?\\s*k?‚Ç¨?/i);
            
            let secteur = 'tech';
            if (lowerText.includes('marketing')) secteur = 'marketing';
            if (lowerText.includes('finance')) secteur = 'finance';
            
            const lines = text.split('\\n').filter(line => line.trim());
            const titre = lines[0] || "Poste √† d√©finir";
            
            return {
                job: {
                    titre: titre,
                    fourchette_salariale: salaryMatch ? `${salaryMatch[1]}-${parseInt(salaryMatch[1]) + 10}k‚Ç¨` : "50000-60000",
                    secteur: secteur,
                    competences_requises: ["Marketing", "Management", "Digital"],
                    coordonnees: { ville: "Paris", adresse: "Paris, France" }
                },
                company: {
                    nom: "Entreprise Test",
                    secteur: secteur,
                    effectif: 250,
                    localisation: "Paris"
                }
            };
        }
        
        function extractName(text) {
            const lines = text.split('\\n').filter(line => line.trim());
            const firstLine = lines[0];
            if (firstLine && firstLine.length < 50 && !firstLine.includes('@')) {
                return firstLine.trim();
            }
            return null;
        }
        
        async function runMatchingTest() {
            console.log('üöÄ Lancement test matching...');
            
            // Utiliser donn√©es d'exemple si pas de donn√©es
            if (!cvData || !jobData) {
                loadTestExample();
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            // Affichage processing
            document.getElementById('processingStatus').classList.remove('hidden');
            document.getElementById('results').classList.remove('hidden');
            
            const mode = document.getElementById('nextenConnection').value;
            
            try {
                const startTime = performance.now();
                let result;
                
                if (mode === 'dynamic') {
                    result = await testDynamicWeightingMatching();
                } else if (mode === 'standard') {
                    result = await testStandardMatching();
                } else {
                    result = await simulateMatching();
                }
                
                result.calculationTime = performance.now() - startTime;
                
                displayResults(result);
                
            } catch (error) {
                console.error('‚ùå Erreur matching:', error);
                document.getElementById('resultsContent').innerHTML = `
                    <div style="color: red;">
                        <strong>‚ùå Erreur:</strong> ${error.message}
                    </div>
                `;
            } finally {
                document.getElementById('processingStatus').classList.add('hidden');
            }
        }
        
        async function testDynamicWeightingMatching() {
            console.log('üéØ Test pond√©ration dynamique...');
            
            // Simulation du syst√®me de pond√©ration dynamique
            const candidateMotivations = cvData.motivations || ['remuneration', 'localisation', 'flexibilite'];
            
            // Calcul des ajustements de pond√©ration
            const baseWeights = {
                semantic: 0.205,
                compensation: 0.196,
                location: 0.161,
                motivation: 0.107,
                companySize: 0.071,
                workEnvironment: 0.071,
                industry: 0.054,
                availability: 0.045,
                contractType: 0.045,
                listenReasons: 0.027,
                processPosition: 0.018
            };
            
            // Application des boosts selon motivations
            const adjustedWeights = { ...baseWeights };
            const adjustments = [];
            
            candidateMotivations.slice(0, 3).forEach((motivation, index) => {
                const boost = [0.08, 0.05, 0.03][index]; // +8%, +5%, +3%
                
                if (motivation === 'remuneration') {
                    adjustedWeights.compensation += boost;
                    adjustments.push({ motivation, criterion: 'compensation', boost });
                } else if (motivation === 'localisation') {
                    adjustedWeights.location += boost;
                    adjustments.push({ motivation, criterion: 'location', boost });
                } else if (motivation === 'flexibilite') {
                    adjustedWeights.workEnvironment += boost / 2;
                    adjustedWeights.contractType += boost / 2;
                    adjustments.push({ motivation, criterion: 'workEnvironment', boost: boost / 2 });
                    adjustments.push({ motivation, criterion: 'contractType', boost: boost / 2 });
                }
            });
            
            // Normalisation √† 100%
            const total = Object.values(adjustedWeights).reduce((sum, w) => sum + w, 0);
            Object.keys(adjustedWeights).forEach(key => {
                adjustedWeights[key] /= total;
            });
            
            // Calcul du score avec pond√©ration dynamique
            const score = calculateMatchingScore(adjustedWeights);
            
            return {
                finalScore: score,
                version: "2.0-DYNAMIC",
                adjustments: adjustments,
                candidateMotivations: candidateMotivations,
                baseWeights: baseWeights,
                adjustedWeights: adjustedWeights,
                dynamicWeightingApplied: true
            };
        }
        
        async function testStandardMatching() {
            console.log('‚öñÔ∏è Test pond√©ration standard...');
            
            const baseWeights = {
                semantic: 0.205,
                compensation: 0.196,
                location: 0.161,
                motivation: 0.107,
                companySize: 0.071,
                workEnvironment: 0.071,
                industry: 0.054,
                availability: 0.045,
                contractType: 0.045,
                listenReasons: 0.027,
                processPosition: 0.018
            };
            
            const score = calculateMatchingScore(baseWeights);
            
            return {
                finalScore: score,
                version: "2.0-STANDARD",
                weights: baseWeights,
                dynamicWeightingApplied: false
            };
        }
        
        async function simulateMatching() {
            console.log('üìä Simulation matching...');
            
            return {
                finalScore: 0.82,
                version: "2.0-SIMULATION",
                dynamicWeightingApplied: false
            };
        }
        
        function calculateMatchingScore(weights) {
            // Simulation de calcul de crit√®res
            const criteriaScores = {
                semantic: 0.85,
                compensation: 0.92,
                location: 0.95,
                motivation: 0.88,
                companySize: 0.75,
                workEnvironment: 0.80,
                industry: 0.90,
                availability: 0.85,
                contractType: 0.90,
                listenReasons: 0.85,
                processPosition: 0.75
            };
            
            let finalScore = 0;
            Object.keys(weights).forEach(criterion => {
                finalScore += criteriaScores[criterion] * weights[criterion];
            });
            
            return Math.min(1.0, finalScore);
        }
        
        function displayResults(result) {
            const content = document.getElementById('resultsContent');
            
            const scorePercentage = Math.round(result.finalScore * 100);
            const qualityClass = result.finalScore >= 0.85 ? 'excellent' : 
                                result.finalScore >= 0.70 ? 'good' : 'average';
            
            let html = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 3rem; font-weight: bold; color: ${getScoreColor(result.finalScore)};">
                        ${scorePercentage}%
                    </div>
                    <div style="font-size: 1.2rem; margin-bottom: 10px;">
                        ${getQualityLabel(qualityClass)}
                    </div>
                    <div style="font-size: 0.9rem; color: #666;">
                        Temps: ${Math.round(result.calculationTime)}ms | Version: ${result.version}
                    </div>
                </div>
            `;
            
            if (result.dynamicWeightingApplied) {
                html += `
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #0ea5e9;">
                        <h4 style="color: #0369a1; margin-bottom: 10px;">üéØ Pond√©ration Dynamique Appliqu√©e</h4>
                        <div><strong>Motivations candidat:</strong> ${result.candidateMotivations.join(', ')}</div>
                        <div style="margin-top: 10px;"><strong>Ajustements:</strong></div>
                        ${result.adjustments.map(adj => 
                            `<div style="margin-left: 10px;">‚Ä¢ ${adj.criterion}: +${Math.round(adj.boost * 100)}% (${adj.motivation})</div>`
                        ).join('')}
                    </div>
                `;
                
                // Comparaison des poids
                html += `
                    <div style="background: #fefce8; padding: 15px; border-radius: 8px;">
                        <h4 style="color: #a16207; margin-bottom: 10px;">‚öñÔ∏è Comparaison des Pond√©rations</h4>
                        <div style="font-size: 12px;">
                            ${Object.keys(result.baseWeights).map(criterion => {
                                const baseWeight = Math.round(result.baseWeights[criterion] * 100);
                                const adjustedWeight = Math.round(result.adjustedWeights[criterion] * 100);
                                const change = adjustedWeight - baseWeight;
                                const changeStr = change > 0 ? `+${change}%` : change < 0 ? `${change}%` : '0%';
                                const changeColor = change > 0 ? '#16a34a' : change < 0 ? '#dc2626' : '#666';
                                
                                return `<div style="display: flex; justify-content: space-between; margin: 2px 0;">
                                    <span>${criterion}:</span>
                                    <span>${baseWeight}% ‚Üí ${adjustedWeight}% <span style="color: ${changeColor};">(${changeStr})</span></span>
                                </div>`;
                            }).join('')}
                        </div>
                    </div>
                `;
            }
            
            content.innerHTML = html;
        }
        
        function getScoreColor(score) {
            if (score >= 0.85) return '#22c55e';
            if (score >= 0.70) return '#3b82f6';
            if (score >= 0.55) return '#f59e0b';
            return '#ef4444';
        }
        
        function getQualityLabel(quality) {
            const labels = {
                excellent: 'üèÜ Match Excellent',
                good: '‚úÖ Bon Match',
                average: '‚ö†Ô∏è Match Moyen',
                poor: '‚ùå Match Faible'
            };
            return labels[quality] || 'üìä Match Analys√©';
        }
        
        function loadTestExample() {
            cvData = testExamples.cv;
            jobData = testExamples.job;
            companyData = testExamples.company;
            
            // Remplir les champs
            document.getElementById('cvText').value = `${cvData.nom}\\n${cvData.email}\\nExp√©rience: ${cvData.experience_annees} ans en ${cvData.secteur_actuel}\\nComp√©tences: ${cvData.competences.join(', ')}\\nPr√©tentions: ${cvData.pretentions_salariales}\\nMotivations: ${cvData.motivations.join(', ')}`;
            
            document.getElementById('jobText').value = `${jobData.titre}\\nEntreprise: ${jobData.entreprise}\\nSalaire: ${jobData.fourchette_salariale}\\nComp√©tences: ${jobData.competences_requises.join(', ')}`;
            
            // Parser automatiquement
            parseCVData();
            parseJobData();
            
            console.log('‚úÖ Exemple de test charg√©');
        }
        
        function testDynamicWeighting() {
            console.log('üéØ Test direct pond√©ration dynamique...');
            
            // Charger exemple et lancer test dynamique
            loadTestExample();
            
            setTimeout(() => {
                document.getElementById('nextenConnection').value = 'dynamic';
                runMatchingTest();
            }, 1000);
        }
    </script>
</body>
</html>