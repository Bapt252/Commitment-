<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXTEN V2.0 Enhanced - Test Contract Type Matching</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://raw.githack.com/Bapt252/Commitment-/main/static/styles/nexten-modern-interactive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --white: #ffffff;
            --black: #000000;
            --purple: #7c3aed;
            --purple-light: #a855f7;
            --purple-dark: #5b21b6;
            --gray: #6b7280;
            --gray-light: #9ca3af;
            --cream: #f9fafb;
            --cream-dark: #e5e7eb;
            --green: #10b981;
            --blue: #3b82f6;
            --orange: #f59e0b;
            --red: #ef4444;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: var(--purple);
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            color: var(--gray);
            font-size: 1.1rem;
        }

        .test-section {
            background: var(--white);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .test-section h2 {
            color: var(--black);
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-case {
            background: var(--cream);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid var(--purple);
        }

        .test-case h3 {
            color: var(--purple);
            font-size: 1.1rem;
            margin-bottom: 15px;
        }

        .test-details {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 10px;
        }

        .test-result {
            padding: 10px;
            border-radius: 6px;
            font-weight: 500;
            margin-top: 10px;
        }

        .test-result.success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--green);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .test-result.error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--red);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .test-result.pending {
            background: rgba(251, 191, 36, 0.1);
            color: var(--orange);
            border: 1px solid rgba(251, 191, 36, 0.2);
        }

        .btn {
            background: linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
            color: var(--white);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 10px 10px 0;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.3);
        }

        .system-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .status-card {
            background: var(--white);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 2px solid var(--cream-dark);
        }

        .status-card.ready {
            border-color: var(--green);
            background: rgba(16, 185, 129, 0.05);
        }

        .status-card.error {
            border-color: var(--red);
            background: rgba(239, 68, 68, 0.05);
        }

        .status-card h4 {
            margin: 0 0 5px 0;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .status-card .value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--black);
        }

        .status-card.ready .value {
            color: var(--green);
        }

        .status-card.error .value {
            color: var(--red);
        }

        .console-output {
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .enhanced-badge {
            background: linear-gradient(135deg, var(--purple), var(--purple-light));
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-rocket"></i> NEXTEN V2.0 Enhanced</h1>
            <p>Test du syst√®me de matching contractuel sophistiqu√©</p>
            <span class="enhanced-badge">Contract Type Enhancement</span>
        </div>

        <!-- Statut du syst√®me -->
        <div class="test-section">
            <h2><i class="fas fa-cogs"></i> Statut du Syst√®me</h2>
            <div class="system-status" id="system-status">
                <div class="status-card" id="nexten-status">
                    <h4>NEXTEN V2.0</h4>
                    <div class="value">‚è≥ Chargement...</div>
                </div>
                <div class="status-card" id="enhancement-status">
                    <h4>Contract Enhancement</h4>
                    <div class="value">‚è≥ Chargement...</div>
                </div>
                <div class="status-card" id="questionnaire-status">
                    <h4>Questionnaire</h4>
                    <div class="value">‚è≥ Chargement...</div>
                </div>
                <div class="status-card" id="integration-status">
                    <h4>Int√©gration</h4>
                    <div class="value">‚è≥ Chargement...</div>
                </div>
            </div>
            
            <button class="btn" onclick="checkSystemStatus()">
                <i class="fas fa-sync"></i> V√©rifier le Statut
            </button>
            <button class="btn" onclick="initializeSystem()">
                <i class="fas fa-play"></i> Initialiser le Syst√®me
            </button>
        </div>

        <!-- Tests de validation -->
        <div class="test-section">
            <h2><i class="fas fa-vial"></i> Tests de Validation du Matching Contractuel</h2>
            
            <div class="test-grid" id="test-grid">
                <!-- Les tests seront ajout√©s dynamiquement -->
            </div>
            
            <button class="btn" onclick="runContractTests()">
                <i class="fas fa-play-circle"></i> Lancer les Tests
            </button>
            <button class="btn" onclick="runSingleTest()">
                <i class="fas fa-flask"></i> Test Rapide
            </button>
            <button class="btn" onclick="clearResults()">
                <i class="fas fa-trash"></i> Effacer les R√©sultats
            </button>
        </div>

        <!-- Sortie console -->
        <div class="test-section">
            <h2><i class="fas fa-terminal"></i> Console de D√©bogage</h2>
            <div class="console-output" id="console-output">
                <div>üöÄ NEXTEN V2.0 Enhanced Contract Type Matching - Console de test</div>
                <div>Chargement des composants...</div>
            </div>
            
            <button class="btn" onclick="clearConsole()">
                <i class="fas fa-eraser"></i> Effacer la Console
            </button>
        </div>
    </div>

    <!-- Scripts NEXTEN V2.0 -->
    <script src="https://raw.githack.com/Bapt252/Commitment-/feature/nexten-v2-11-criteria/js/engines/nexten-v2/core/nexten-v2-optimized-system.js"></script>
    
    <!-- Script d'am√©lioration Contract Type -->
    <script src="https://raw.githack.com/Bapt252/Commitment-/feature/nexten-v2-11-criteria/js/engines/nexten-v2/enhancements/contract-type-enhanced-matching.js"></script>
    
    <script>
        // ========================================
        // SYST√àME DE TEST POUR CONTRACT TYPE ENHANCED
        // ========================================
        
        class ContractTypeTestSuite {
            constructor() {
                this.nextenSystem = null;
                this.testResults = [];
                this.consoleDiv = document.getElementById('console-output');
                
                this.testCases = [
                    {
                        name: "Candidat exclusif CDI vs Poste CDI",
                        description: "Correspondance exacte exclusive ‚Üí 100%",
                        candidate: {
                            'contract-types-selected': 'cdi',
                            'contract-preference-level': 'exclusive',
                            'contract-primary-choice': 'cdi'
                        },
                        job: { contractType: 'cdi' },
                        expected: 1.0,
                        tolerance: 0.05
                    },
                    {
                        name: "Candidat pr√©f√®re CDI, accepte CDD vs Poste CDD",
                        description: "Correspondance pr√©f√©rentielle ‚Üí 80%",
                        candidate: {
                            'contract-types-selected': 'cdi,cdd',
                            'contract-preference-level': 'preferred',
                            'contract-primary-choice': 'cdi'
                        },
                        job: { contractType: 'cdd' },
                        expected: 0.8,
                        tolerance: 0.05
                    },
                    {
                        name: "Candidat accepte plusieurs types vs Poste Freelance",
                        description: "Correspondance acceptable ‚Üí 70%",
                        candidate: {
                            'contract-types-selected': 'cdi,freelance',
                            'contract-preference-level': 'acceptable',
                            'contract-primary-choice': 'cdi'
                        },
                        job: { contractType: 'freelance' },
                        expected: 0.7,
                        tolerance: 0.05
                    },
                    {
                        name: "Candidat exclusif CDI vs Poste Freelance",
                        description: "Non-correspondance ‚Üí 0%",
                        candidate: {
                            'contract-types-selected': 'cdi',
                            'contract-preference-level': 'exclusive',
                            'contract-primary-choice': 'cdi'
                        },
                        job: { contractType: 'freelance' },
                        expected: 0.0,
                        tolerance: 0.05
                    },
                    {
                        name: "Candidat flexible vs Poste Interim",
                        description: "Correspondance flexible ‚Üí 80%",
                        candidate: {
                            'contract-types-selected': 'cdi,cdd,interim',
                            'contract-preference-level': 'flexible',
                            'contract-primary-choice': 'cdi'
                        },
                        job: { contractType: 'interim' },
                        expected: 0.8,
                        tolerance: 0.05
                    },
                    {
                        name: "Test avec donn√©es questionnaire enhanced",
                        description: "Donn√©es sophistiqu√©es du questionnaire",
                        candidate: {
                            contractData: {
                                selectedTypes: ['cdi', 'cdd'],
                                preferenceLevel: 'preferred',
                                primaryChoice: 'cdi',
                                isValid: true
                            }
                        },
                        job: { contractType: 'cdi' },
                        expected: 1.0,
                        tolerance: 0.05
                    }
                ];
                
                this.init();
            }
            
            init() {
                this.log('üîß Initialisation du syst√®me de test...');
                this.renderTestCases();
                
                // V√©rification p√©riodique du syst√®me
                this.checkSystemStatusPeriodically();
            }
            
            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                
                let color = '#00ff00';
                if (type === 'error') color = '#ff4444';
                if (type === 'warning') color = '#ffaa00';
                if (type === 'success') color = '#44ff44';
                
                logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> <span style="color: ${color};">${message}</span>`;
                this.consoleDiv.appendChild(logEntry);
                this.consoleDiv.scrollTop = this.consoleDiv.scrollHeight;
            }
            
            renderTestCases() {
                const testGrid = document.getElementById('test-grid');
                testGrid.innerHTML = '';
                
                this.testCases.forEach((testCase, index) => {
                    const testDiv = document.createElement('div');
                    testDiv.className = 'test-case';
                    testDiv.id = `test-case-${index}`;
                    
                    testDiv.innerHTML = `
                        <h3>Test ${index + 1}: ${testCase.name}</h3>
                        <div class="test-details">
                            ${testCase.description}<br>
                            <strong>Attendu:</strong> ${Math.round(testCase.expected * 100)}%
                        </div>
                        <div class="test-result pending" id="result-${index}">
                            <i class="fas fa-clock"></i> En attente
                        </div>
                    `;
                    
                    testGrid.appendChild(testDiv);
                });
            }
            
            async checkSystemStatus() {
                this.log('üîç V√©rification du statut du syst√®me...');
                
                // NEXTEN V2.0
                const nextenCard = document.getElementById('nexten-status');
                if (typeof NextenV2OptimizedSystem !== 'undefined') {
                    nextenCard.className = 'status-card ready';
                    nextenCard.querySelector('.value').textContent = '‚úÖ Charg√©';
                    this.log('‚úÖ NEXTEN V2.0 System d√©tect√©', 'success');
                } else {
                    nextenCard.className = 'status-card error';
                    nextenCard.querySelector('.value').textContent = '‚ùå Non trouv√©';
                    this.log('‚ùå NEXTEN V2.0 System non trouv√©', 'error');
                }
                
                // Enhancement
                const enhancementCard = document.getElementById('enhancement-status');
                if (typeof window.enhanceNextenContractCriterion !== 'undefined') {
                    enhancementCard.className = 'status-card ready';
                    enhancementCard.querySelector('.value').textContent = '‚úÖ Actif';
                    this.log('‚úÖ Contract Type Enhancement d√©tect√©', 'success');
                } else {
                    enhancementCard.className = 'status-card error';
                    enhancementCard.querySelector('.value').textContent = '‚ùå Non actif';
                    this.log('‚ùå Contract Type Enhancement non trouv√©', 'error');
                }
                
                // Questionnaire
                const questionnaireCard = document.getElementById('questionnaire-status');
                questionnaireCard.className = 'status-card ready';
                questionnaireCard.querySelector('.value').textContent = '‚úÖ Compatible';
                
                // Int√©gration
                const integrationCard = document.getElementById('integration-status');
                try {
                    this.nextenSystem = new NextenV2OptimizedSystem();
                    if (this.nextenSystem.calculateContractTypeCriterion) {
                        integrationCard.className = 'status-card ready';
                        integrationCard.querySelector('.value').textContent = '‚úÖ Int√©gr√©';
                        this.log('‚úÖ Int√©gration syst√®me r√©ussie', 'success');
                    } else {
                        throw new Error('M√©thode manquante');
                    }
                } catch (error) {
                    integrationCard.className = 'status-card error';
                    integrationCard.querySelector('.value').textContent = '‚ùå Erreur';
                    this.log('‚ùå Erreur d\'int√©gration: ' + error.message, 'error');
                }
            }
            
            async initializeSystem() {
                this.log('üöÄ Initialisation manuelle du syst√®me...');
                
                try {
                    // Forcer le rechargement des am√©liorations
                    if (typeof window.enhanceNextenContractCriterion === 'function') {
                        window.enhanceNextenContractCriterion();
                        this.log('‚úÖ Enhancement Contract Type appliqu√© manuellement', 'success');
                    }
                    
                    // R√©initialiser NEXTEN
                    this.nextenSystem = new NextenV2OptimizedSystem();
                    this.log('‚úÖ NEXTEN V2.0 System r√©initialis√©', 'success');
                    
                    // Mettre √† jour le statut
                    await this.checkSystemStatus();
                    
                } catch (error) {
                    this.log('‚ùå Erreur lors de l\'initialisation: ' + error.message, 'error');
                }
            }
            
            async runContractTests() {
                this.log('üß™ Lancement des tests de validation Contract Type...');
                
                if (!this.nextenSystem) {
                    this.log('‚ùå Syst√®me NEXTEN non initialis√©', 'error');
                    return;
                }
                
                for (let i = 0; i < this.testCases.length; i++) {
                    await this.runSingleTestCase(i);
                    await new Promise(resolve => setTimeout(resolve, 500)); // Pause entre tests
                }
                
                this.log('üéØ Tous les tests termin√©s', 'success');
            }
            
            async runSingleTestCase(index) {
                const testCase = this.testCases[index];
                const resultDiv = document.getElementById(`result-${index}`);
                
                this.log(`üî¨ Test ${index + 1}: ${testCase.name}`);
                
                try {
                    resultDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> En cours...';
                    resultDiv.className = 'test-result pending';
                    
                    const result = await this.nextenSystem.calculateContractTypeCriterion(
                        testCase.candidate,
                        testCase.job
                    );
                    
                    const score = result.score;
                    const isSuccess = Math.abs(score - testCase.expected) <= testCase.tolerance;
                    
                    if (isSuccess) {
                        resultDiv.innerHTML = `<i class="fas fa-check-circle"></i> ‚úÖ R√âUSSI<br>Score: ${Math.round(score * 100)}% (attendu: ${Math.round(testCase.expected * 100)}%)<br>Match: ${result.details?.matchType || 'N/A'}`;
                        resultDiv.className = 'test-result success';
                        this.log(`‚úÖ Test ${index + 1} r√©ussi: ${Math.round(score * 100)}%`, 'success');
                    } else {
                        resultDiv.innerHTML = `<i class="fas fa-times-circle"></i> ‚ùå √âCHOU√â<br>Score: ${Math.round(score * 100)}% (attendu: ${Math.round(testCase.expected * 100)}%)<br>√âcart: ${Math.round(Math.abs(score - testCase.expected) * 100)}%`;
                        resultDiv.className = 'test-result error';
                        this.log(`‚ùå Test ${index + 1} √©chou√©: ${Math.round(score * 100)}% vs ${Math.round(testCase.expected * 100)}%`, 'error');
                    }
                    
                    if (result.details?.reasoning) {
                        this.log(`üí≠ Reasoning: ${result.details.reasoning}`);
                    }
                    
                } catch (error) {
                    resultDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ‚ùå ERREUR<br>${error.message}`;
                    resultDiv.className = 'test-result error';
                    this.log(`‚ùå Erreur test ${index + 1}: ${error.message}`, 'error');
                }
            }
            
            async runSingleTest() {
                this.log('‚ö° Test rapide de validation...');
                
                if (!this.nextenSystem) {
                    await this.initializeSystem();
                }
                
                await this.runSingleTestCase(0); // Premier test
            }
            
            clearResults() {
                this.testCases.forEach((_, index) => {
                    const resultDiv = document.getElementById(`result-${index}`);
                    resultDiv.innerHTML = '<i class="fas fa-clock"></i> En attente';
                    resultDiv.className = 'test-result pending';
                });
                this.log('üßπ R√©sultats effac√©s');
            }
            
            clearConsole() {
                this.consoleDiv.innerHTML = '<div>üöÄ NEXTEN V2.0 Enhanced Contract Type Matching - Console nettoy√©e</div>';
            }
            
            checkSystemStatusPeriodically() {
                // V√©rification automatique au chargement
                setTimeout(() => {
                    this.checkSystemStatus();
                }, 1000);
            }
        }
        
        // ========================================
        // FONCTIONS GLOBALES
        // ========================================
        
        let testSuite;
        
        function checkSystemStatus() {
            if (testSuite) testSuite.checkSystemStatus();
        }
        
        function initializeSystem() {
            if (testSuite) testSuite.initializeSystem();
        }
        
        function runContractTests() {
            if (testSuite) testSuite.runContractTests();
        }
        
        function runSingleTest() {
            if (testSuite) testSuite.runSingleTest();
        }
        
        function clearResults() {
            if (testSuite) testSuite.clearResults();
        }
        
        function clearConsole() {
            if (testSuite) testSuite.clearConsole();
        }
        
        // ========================================
        // INITIALISATION
        // ========================================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initialisation de la page de test Contract Type Enhanced');
            testSuite = new ContractTypeTestSuite();
        });
        
    </script>
</body>
</html>