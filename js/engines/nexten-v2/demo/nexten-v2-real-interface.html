<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXTEN V2.0 - Interface R√©elle avec Tous les Modules</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .loading-section {
            padding: 30px;
            text-align: center;
        }
        
        .loading-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .loading-success {
            background: #dcfce7;
            color: #166534;
        }
        
        .loading-error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .loading-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        .test-panel {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .results-panel {
            grid-column: 1 / -1;
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }
        
        .final-score {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 25px;
        }
        
        .final-score .score {
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .criteria-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border-left: 5px solid #667eea;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .criteria-score {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .score-excellent { color: #22c55e; }
        .score-good { color: #3b82f6; }
        .score-average { color: #f59e0b; }
        .score-poor { color: #ef4444; }
        
        .debug-section {
            background: #f3f4f6;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ NEXTEN V2.0 - INTERFACE R√âELLE</h1>
            <div class="version">Chargement de tous les modules et vrais calculs</div>
        </div>
        
        <div class="loading-section" id="loadingSection">
            <h2>üì¶ Chargement des Modules NEXTEN V2.0</h2>
            <div id="loadingStatus">
                <div class="loading-item loading-pending" id="loading-core">
                    <span>Orchestrateur Principal (NextenV2UnifiedSystem)</span>
                    <span>‚è≥</span>
                </div>
                <div class="loading-item loading-pending" id="loading-compensation">
                    <span>CompensationMatcher (15%)</span>
                    <span>‚è≥</span>
                </div>
                <div class="loading-item loading-pending" id="loading-motivation">
                    <span>MotivationMatcher (10%)</span>
                    <span>‚è≥</span>
                </div>
                <div class="loading-item loading-pending" id="loading-companysize">
                    <span>CompanySizeMatcher (8%)</span>
                    <span>‚è≥</span>
                </div>
                <div class="loading-item loading-pending" id="loading-workenvironment">
                    <span>WorkEnvironmentMatcher (8%)</span>
                    <span>‚è≥</span>
                </div>
                <div class="loading-item loading-pending" id="loading-industry">
                    <span>IndustryMatcher (6%)</span>
                    <span>‚è≥</span>
                </div>
                <div class="loading-item loading-pending" id="loading-additional">
                    <span>AdditionalCriteria (15% - 4 crit√®res)</span>
                    <span>‚è≥</span>
                </div>
                <div class="loading-item loading-pending" id="loading-mapper">
                    <span>QuestionnaireMapper</span>
                    <span>‚è≥</span>
                </div>
            </div>
            
            <div id="systemReadyMessage" style="display: none;">
                <h3 style="color: #166534; margin-top: 20px;">‚úÖ Syst√®me NEXTEN V2.0 Pr√™t !</h3>
                <p>Tous les modules sont charg√©s. Les calculs utilisent maintenant les vrais algorithmes.</p>
            </div>
        </div>
        
        <div class="main-content" id="mainContent" style="display: none;">
            <!-- Panel Candidat -->
            <div class="test-panel">
                <h2>üë§ Donn√©es Candidat</h2>
                
                <div class="form-group">
                    <label>Nom du candidat</label>
                    <input type="text" id="candidateName" value="Doroth√©e Lim">
                </div>
                
                <div class="form-group">
                    <label>Pr√©tentions salariales</label>
                    <input type="text" id="salaryExpectation" value="85-95k‚Ç¨">
                </div>
                
                <div class="form-group">
                    <label>Motivations principales</label>
                    <select id="motivations" multiple size="3">
                        <option value="evolution_carriere" selected>√âvolution de carri√®re</option>
                        <option value="innovation_creativite" selected>Innovation & cr√©ativit√©</option>
                        <option value="remuneration" selected>R√©mun√©ration attractive</option>
                        <option value="equilibre_vie_pro">√âquilibre vie pro/perso</option>
                        <option value="autonomie_responsabilite">Autonomie & responsabilit√©</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Localisation candidat</label>
                    <input type="text" id="candidateLocation" value="Paris 1er arrondissement" placeholder="Adresse pr√©cise">
                </div>
                
                <div class="form-group">
                    <label>Disponibilit√©</label>
                    <select id="availability">
                        <option value="immediate">Imm√©diate</option>
                        <option value="1_mois">1 mois</option>
                        <option value="3_mois" selected>3 mois</option>
                        <option value="6_mois">6 mois</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Comp√©tences (s√©par√©es par virgules)</label>
                    <input type="text" id="competences" value="Marketing, Brand Management, Luxe, Digital, Leadership">
                </div>
                
                <div class="form-group">
                    <label>Exp√©riences (JSON)</label>
                    <textarea id="experiences" rows="3">[{"entreprise": "LVMH", "poste": "Chef de Produit", "secteur": "luxe", "duree": "3 ans"}, {"entreprise": "Chanel", "poste": "Marketing Manager", "secteur": "luxe", "duree": "2 ans"}]</textarea>
                </div>
            </div>
            
            <!-- Panel Entreprise -->
            <div class="test-panel">
                <h2>üè¢ Donn√©es Entreprise & Poste</h2>
                
                <div class="form-group">
                    <label>Nom de l'entreprise</label>
                    <input type="text" id="companyName" value="Maison Lumi√®re">
                </div>
                
                <div class="form-group">
                    <label>Poste propos√©</label>
                    <input type="text" id="jobTitle" value="Directeur Marketing - Maison de Luxe">
                </div>
                
                <div class="form-group">
                    <label>Localisation poste</label>
                    <input type="text" id="jobLocation" value="Paris 8√®me arrondissement" placeholder="Adresse pr√©cise">
                </div>
                
                <div class="form-group">
                    <label>Fourchette salariale</label>
                    <input type="text" id="salaryRange" value="90-110k‚Ç¨">
                </div>
                
                <div class="form-group">
                    <label>Secteur d'activit√©</label>
                    <select id="companySector">
                        <option value="luxe" selected>Luxe</option>
                        <option value="mode">Mode</option>
                        <option value="cosmetique">Cosm√©tique</option>
                        <option value="tech">Technologie</option>
                        <option value="finance">Finance</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Effectif entreprise</label>
                    <input type="number" id="employeeCount" value="850">
                </div>
                
                <div class="form-group">
                    <label>Urgence recrutement</label>
                    <select id="urgency">
                        <option value="normal" selected>Normal (1-2 mois)</option>
                        <option value="urgent">Urgent (< 1 mois)</option>
                        <option value="flexible">Flexible (> 3 mois)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Comp√©tences requises (s√©par√©es par virgules)</label>
                    <input type="text" id="requiredSkills" value="Marketing, Luxe, Management, Strat√©gie, Digital">
                </div>
                
                <button class="btn" onclick="runRealNextenV2Test()" id="testButton" disabled>üöÄ Test NEXTEN V2.0 R√âEL</button>
            </div>
        </div>
        
        <!-- R√©sultats -->
        <div class="results-panel" id="resultsPanel" style="display: none;">
            <div id="finalScoreDisplay">
                <div class="final-score">
                    <div class="score" id="finalScore">---%</div>
                    <div class="level" id="qualityLevel">Calcul en cours...</div>
                </div>
            </div>
            
            <div id="criteriaResults" class="criteria-grid">
                <!-- R√©sultats des crit√®res inject√©s ici -->
            </div>
            
            <div class="debug-section">
                <h3>üîç Debug - Modules Utilis√©s</h3>
                <pre id="debugInfo">Lancement du test...</pre>
            </div>
        </div>
    </div>
    
    <!-- CHARGEMENT DE TOUS LES MODULES NEXTEN V2.0 -->
    <script src="../core/questionnaire-mapper.js"></script>
    <script src="../criteria/compensation-matcher.js"></script>
    <script src="../criteria/motivation-matcher.js"></script>
    <script src="../criteria/company-size-matcher.js"></script>
    <script src="../criteria/work-environment-matcher.js"></script>
    <script src="../criteria/industry-matcher.js"></script>
    <script src="../criteria/additional-criteria.js"></script>
    <script src="../core/nexten-v2-unified-system.js"></script>
    
    <script>
        // Variables globales
        let nextenV2System = null;
        let modulesLoaded = {};
        let systemReady = false;
        
        // Initialisation progressive
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkModulesAvailability, 500);
        });
        
        function checkModulesAvailability() {
            console.log('üîç V√©rification des modules NEXTEN V2.0...');
            
            // V√©rification de chaque module
            checkModule('QuestionnaireMapper', 'loading-mapper');
            checkModule('CompensationMatcher', 'loading-compensation');
            checkModule('MotivationMatcher', 'loading-motivation');
            checkModule('CompanySizeMatcher', 'loading-companysize');
            checkModule('WorkEnvironmentMatcher', 'loading-workenvironment');
            checkModule('IndustryMatcher', 'loading-industry');
            checkModule('AdditionalCriteria', 'loading-additional');
            checkModule('NextenV2UnifiedSystem', 'loading-core');
            
            // V√©rification si tout est pr√™t
            const allModulesLoaded = Object.values(modulesLoaded).every(loaded => loaded);
            
            if (allModulesLoaded) {
                initializeRealSystem();
            } else {
                showMissingModules();
            }
        }
        
        function checkModule(moduleName, elementId) {
            const isAvailable = typeof window[moduleName] !== 'undefined';
            modulesLoaded[moduleName] = isAvailable;
            
            const element = document.getElementById(elementId);
            if (isAvailable) {
                element.className = 'loading-item loading-success';
                element.querySelector('span:last-child').textContent = '‚úÖ';
                console.log(`‚úÖ ${moduleName} charg√©`);
            } else {
                element.className = 'loading-item loading-error';
                element.querySelector('span:last-child').textContent = '‚ùå';
                console.error(`‚ùå ${moduleName} manquant`);
            }
        }
        
        function initializeRealSystem() {
            try {
                console.log('üöÄ Initialisation du syst√®me NEXTEN V2.0 r√©el...');
                
                // Instanciation du vrai syst√®me
                nextenV2System = new NextenV2UnifiedSystem();
                systemReady = true;
                
                // Interface pr√™te
                document.getElementById('systemReadyMessage').style.display = 'block';
                document.getElementById('mainContent').style.display = 'grid';
                document.getElementById('testButton').disabled = false;
                
                console.log('‚úÖ Syst√®me NEXTEN V2.0 r√©el initialis√© avec succ√®s');
                
            } catch (error) {
                console.error('‚ùå Erreur initialisation syst√®me r√©el:', error);
                showSystemError(error);
            }
        }
        
        function showMissingModules() {
            const missingModules = Object.entries(modulesLoaded)
                .filter(([module, loaded]) => !loaded)
                .map(([module]) => module);
            
            console.error('‚ùå Modules manquants:', missingModules);
            
            // Affichage des instructions pour charger les modules
            const instructions = `
                <div style="background: #fee2e2; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <h3 style="color: #991b1b;">‚ö†Ô∏è Modules NEXTEN V2.0 Manquants</h3>
                    <p><strong>Modules non trouv√©s:</strong> ${missingModules.join(', ')}</p>
                    <br>
                    <p><strong>Pour utiliser le syst√®me r√©el :</strong></p>
                    <ol>
                        <li>V√©rifier que tous les fichiers .js sont pr√©sents dans les dossiers /core et /criteria</li>
                        <li>Ouvrir cette page depuis le serveur (pas en local file://)</li>
                        <li>V√©rifier les chemins des scripts dans le HTML</li>
                    </ol>
                    <br>
                    <p><em>L'interface utilise actuellement une simulation en attendant les vrais modules.</em></p>
                </div>
            `;
            
            document.getElementById('loadingSection').innerHTML += instructions;
        }
        
        function showSystemError(error) {
            const errorMessage = `
                <div style="background: #fee2e2; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <h3 style="color: #991b1b;">‚ùå Erreur Syst√®me</h3>
                    <p><strong>Erreur:</strong> ${error.message}</p>
                    <p><em>V√©rifiez la console pour plus de d√©tails.</em></p>
                </div>
            `;
            
            document.getElementById('loadingSection').innerHTML += errorMessage;
        }
        
        async function runRealNextenV2Test() {
            if (!systemReady || !nextenV2System) {
                alert('‚ùå Syst√®me non initialis√©');
                return;
            }
            
            try {
                console.log('üöÄ Lancement test NEXTEN V2.0 avec vrais modules...');
                
                // Extraction des donn√©es du formulaire
                const candidateData = extractDetailedCandidateData();
                const jobData = extractDetailedJobData();
                const companyData = extractDetailedCompanyData();
                
                console.log('üìã Donn√©es candidat:', candidateData);
                console.log('üè¢ Donn√©es job:', jobData);
                console.log('üè≠ Donn√©es company:', companyData);
                
                // Affichage des r√©sultats en cours
                document.getElementById('resultsPanel').style.display = 'block';
                document.getElementById('debugInfo').textContent = 'Calcul en cours avec vrais modules...';
                
                // CALCUL R√âEL avec le vrai syst√®me
                const startTime = performance.now();
                const result = await nextenV2System.calculateV2MatchingScore(candidateData, jobData, companyData);
                const calculationTime = performance.now() - startTime;
                
                console.log('üéØ R√©sultat R√âEL V2.0:', result);
                
                // Affichage des r√©sultats
                displayRealResults(result, calculationTime);
                
                // Debug info
                const debugInfo = {
                    systemVersion: result.version,
                    matchingMode: result.matchingMode,
                    modulesUsed: Object.keys(result.criteriaBreakdown?.criteria || {}),
                    realCalculation: true,
                    dataQuality: result.dataUsage,
                    performance: result.performance
                };
                
                document.getElementById('debugInfo').textContent = JSON.stringify(debugInfo, null, 2);
                
            } catch (error) {
                console.error('‚ùå Erreur test r√©el:', error);
                document.getElementById('debugInfo').textContent = `Erreur: ${error.message}\n\nStack: ${error.stack}`;
            }
        }
        
        function extractDetailedCandidateData() {
            const motivations = Array.from(document.getElementById('motivations').selectedOptions)
                               .map(option => option.value);
            
            let experiences = [];
            try {
                experiences = JSON.parse(document.getElementById('experiences').value);
            } catch (e) {
                console.warn('Erreur parsing exp√©riences, utilisation par d√©faut');
                experiences = [{ entreprise: "Exp√©rience Pr√©c√©dente", poste: "Manager", secteur: "luxe" }];
            }
            
            return {
                id: 'real_test_candidate',
                nom: document.getElementById('candidateName').value,
                pretentions_salariales: document.getElementById('salaryExpectation').value,
                motivations: motivations,
                taille_entreprise_preference: "groupe",
                environnement_prefere: "hybrid_3_2",
                secteurs_cibles: ["luxe", "mode", "cosmetique"],
                disponibilite: document.getElementById('availability').value,
                type_contrat_souhaite: "cdi",
                competences: document.getElementById('competences').value.split(',').map(s => s.trim()),
                experiences: experiences,
                coordonnees: { 
                    ville: "Paris",
                    adresse: document.getElementById('candidateLocation').value,
                    latitude: 48.8566,
                    longitude: 2.3522
                }
            };
        }
        
        function extractDetailedJobData() {
            return {
                id: 'real_test_job',
                titre: document.getElementById('jobTitle').value,
                fourchette_salariale: document.getElementById('salaryRange').value,
                secteur: document.getElementById('companySector').value,
                mode_travail: "hybrid_3_2",
                urgence_recrutement: document.getElementById('urgency').value,
                type_contrat: "cdi",
                competences_requises: document.getElementById('requiredSkills').value.split(',').map(s => s.trim()),
                missions: ["Strat√©gie marketing", "Management √©quipe", "D√©veloppement marque"],
                coordonnees: { 
                    ville: "Paris",
                    adresse: document.getElementById('jobLocation').value,
                    latitude: 48.8566,
                    longitude: 2.3522
                }
            };
        }
        
        function extractDetailedCompanyData() {
            return {
                nom: document.getElementById('companyName').value,
                secteur: document.getElementById('companySector').value,
                effectif: parseInt(document.getElementById('employeeCount').value),
                localisation: "Paris",
                taille_equipe: 12,
                avantages: ["mutuelle", "restaurant", "remote"]
            };
        }
        
        function displayRealResults(result, calculationTime) {
            const finalScore = Math.round((result.finalScore || 0.5) * 100);
            document.getElementById('finalScore').textContent = finalScore + '%';
            document.getElementById('qualityLevel').textContent = getQualityLabel(result.qualityLevel || 'acceptable');
            
            displayRealCriteriaResults(result.criteriaBreakdown?.criteria || {});
        }
        
        function displayRealCriteriaResults(criteriaBreakdown) {
            const criteriaContainer = document.getElementById('criteriaResults');
            criteriaContainer.innerHTML = '';
            
            const criteriaInfo = {
                semantic: { name: 'Compatibilit√© S√©mantique', weight: '25%', icon: 'üß†' },
                location: { name: 'G√©olocalisation R√âELLE', weight: '20%', icon: 'üìç' },
                compensation: { name: 'R√©mun√©ration R√âELLE', weight: '15%', icon: 'üí∞' },
                motivation: { name: 'Motivations R√âELLES', weight: '10%', icon: 'üéØ' },
                companySize: { name: 'Taille Entreprise', weight: '8%', icon: 'üè¢' },
                workEnvironment: { name: 'Environnement Travail', weight: '8%', icon: 'üè†' },
                industry: { name: 'Secteur d\'Activit√©', weight: '6%', icon: 'üè≠' },
                availability: { name: 'Disponibilit√© R√âELLE', weight: '5%', icon: '‚è∞' },
                contractType: { name: 'Type de Contrat', weight: '5%', icon: 'üìã' },
                listenReasons: { name: 'Anti-patterns', weight: '3%', icon: 'üé≠' },
                processPosition: { name: 'Position Processus', weight: '2%', icon: 'üìà' }
            };
            
            Object.entries(criteriaInfo).forEach(([criterionKey, info]) => {
                const criterionData = criteriaBreakdown[criterionKey];
                
                if (criterionData) {
                    const score = criterionData.score || 0;
                    const percentage = criterionData.percentage || Math.round(score * 100);
                    
                    const card = document.createElement('div');
                    card.className = 'criteria-card';
                    card.innerHTML = `
                        <h3>${info.icon} ${info.name}</h3>
                        <div class="criteria-score ${getScoreClass(score)}">${percentage}%</div>
                        <div class="criteria-details">
                            Pond√©ration: ${info.weight}<br>
                            ${getScoreDescription(score)}<br>
                            <small>Calcul: ${criterionData.fallback ? 'Fallback' : 'R√âEL'}</small>
                        </div>
                    `;
                    
                    criteriaContainer.appendChild(card);
                } else {
                    // Crit√®re non calcul√©
                    const card = document.createElement('div');
                    card.className = 'criteria-card';
                    card.style.opacity = '0.5';
                    card.innerHTML = `
                        <h3>${info.icon} ${info.name}</h3>
                        <div class="criteria-score score-poor">N/A</div>
                        <div class="criteria-details">
                            Pond√©ration: ${info.weight}<br>
                            Non calcul√©<br>
                            <small>Module non disponible</small>
                        </div>
                    `;
                    
                    criteriaContainer.appendChild(card);
                }
            });
        }
        
        function getQualityLabel(level) {
            const labels = {
                excellent: 'üèÜ Match Excellent',
                good: '‚úÖ Bon Match', 
                acceptable: '‚ö†Ô∏è Match Acceptable',
                poor: '‚ùå Match Faible'
            };
            return labels[level] || '‚ö° Match Analys√©';
        }
        
        function getScoreClass(score) {
            if (score >= 0.85) return 'score-excellent';
            if (score >= 0.70) return 'score-good';
            if (score >= 0.55) return 'score-average';
            return 'score-poor';
        }
        
        function getScoreDescription(score) {
            if (score >= 0.85) return 'Excellent alignement';
            if (score >= 0.70) return 'Bon alignement';
            if (score >= 0.55) return 'Alignement acceptable';
            return 'Alignement faible';
        }
    </script>
</body>
</html>