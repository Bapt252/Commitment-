<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Téléchargez votre CV - Nexten</title>
    <link rel="stylesheet" href="../static/styles/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        main.container {
            max-width: 900px;
            margin: 80px auto 50px;
            padding: 2rem;
        }
        
        .stepper {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 33%;
            position: relative;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .step.active .step-number {
            background-color: var(--primary);
            color: white;
        }
        
        .step-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #6b7280;
        }
        
        .step.active .step-label {
            color: var(--primary);
            font-weight: 600;
        }
        
        .page-header {
            margin-bottom: 2rem;
        }
        
        .page-header h1 {
            font-size: 1.8rem;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            color: var(--text);
            font-size: 1.1rem;
            max-width: 700px;
        }
        
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .option {
            display: flex;
            align-items: center;
            padding: 1.5rem;
            background-color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        
        .option:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .option.active {
            border: 2px solid var(--primary);
        }
        
        .option-icon {
            font-size: 1.5rem;
            color: var(--primary);
            padding: 1rem;
            background-color: #EEF2FF;
            border-radius: 0.5rem;
            margin-right: 1rem;
        }
        
        .option-content {
            flex: 1;
        }
        
        .option-content h3 {
            margin: 0 0 0.5rem 0;
            color: var(--dark);
        }
        
        .option-content p {
            margin: 0;
            color: var(--text);
            font-size: 0.95rem;
        }
        
        .option-arrow {
            color: var(--primary);
            margin-left: 1rem;
        }
        
        .upload-container {
            margin-top: 2rem;
            padding: 2rem;
            background-color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
        }
        
        .alert {
            display: flex;
            padding: 1rem;
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
        }
        
        .alert-info {
            background-color: #EFF6FF;
            border-left: 4px solid #3B82F6;
        }
        
        .alert-icon {
            color: #3B82F6;
            font-size: 1.2rem;
            margin-right: 1rem;
            display: flex;
            align-items: center;
        }
        
        .alert-content {
            flex: 1;
        }
        
        .alert-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--dark);
        }
        
        .alert-text {
            color: var(--text);
            font-size: 0.95rem;
        }
        
        .file-upload-container {
            margin-top: 1.5rem;
        }
        
        .file-upload-label {
            display: flex;
            align-items: center;
            padding: 2rem;
            border: 2px dashed #d1d5db;
            border-radius: var(--radius);
            background-color: #f9fafb;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .file-upload-label:hover {
            border-color: var(--primary);
        }
        
        .file-upload-icon {
            font-size: 2rem;
            color: var(--primary);
            margin-right: 1.5rem;
        }
        
        .file-upload-text {
            color: var(--text);
        }
        
        .file-upload-text strong {
            color: var(--primary);
        }
        
        .file-upload-text span {
            display: block;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            color: #6b7280;
        }
        
        .file-preview {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: var(--radius);
            background-color: white;
            margin-top: 1.5rem;
        }
        
        .file-preview-content {
            display: flex;
            align-items: center;
        }
        
        .file-icon {
            font-size: 2rem;
            color: #f43f5e;
            margin-right: 1rem;
        }
        
        .file-name {
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 0.25rem;
        }
        
        .file-size {
            font-size: 0.9rem;
            color: #6b7280;
        }
        
        .file-preview-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .btn-text {
            background: none;
            color: var(--primary);
            border: none;
            padding: 0.5rem;
            font-weight: 500;
            cursor: pointer;
        }
        
        .progress-container {
            margin-top: 1.5rem;
        }
        
        .progress-text-wrapper {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: var(--text);
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background-color: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            width: 0;
            background-color: var(--primary);
            transition: width 0.3s;
        }
        
        .result-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 2rem;
            margin-top: 1.5rem;
            border: 1px solid #e5e7eb;
            border-radius: var(--radius);
            background-color: #f9fafb;
        }
        
        .result-icon {
            font-size: 3rem;
            color: #10B981;
            margin-bottom: 1rem;
        }
        
        .result-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }
        
        .result-text {
            color: var(--text);
            max-width: 600px;
            margin-bottom: 1.5rem;
        }
        
        .result-details {
            background-color: white;
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            width: 100%;
            max-width: 600px;
            margin-bottom: 1.5rem;
            text-align: left;
        }
        
        .detail-item {
            display: flex;
            margin-bottom: 0.75rem;
        }
        
        .detail-item:last-child {
            margin-bottom: 0;
        }
        
        .detail-label {
            font-weight: 500;
            color: var(--dark);
            min-width: 150px;
        }
        
        .detail-value {
            color: var(--text);
        }
        
        .result-actions {
            margin-top: 1rem;
        }
    </style>
    <script>
        function handleGoogleMapsError() {
            console.error("Erreur de chargement de l'API Google Maps");
            // Ajouter un message d'erreur visible à l'utilisateur si nécessaire
        }

        function initAutocompleteCallback() {
            console.log("Google Maps API chargée avec succès");
            try {
                // La fonction initAutocomplete sera définie dans notre script
                if (typeof initAutocomplete === 'function') {
                    initAutocomplete();
                }
            } catch (e) {
                console.error("Erreur lors de l'initialisation de l'autocomplete", e);
                handleGoogleMapsError();
            }
        }
    </script>
</head>
<body>
    <div id="header"></div>
    
    <main class="container">
        <div class="stepper step1">
            <div class="step active">
                <div class="step-number">1</div>
                <div class="step-label">Télécharger CV</div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-label">Questionnaire</div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-label">Matchs</div>
            </div>
        </div>
        
        <div class="page-header">
            <h1>Téléchargez votre CV</h1>
            <p class="subtitle">Commencez par télécharger votre CV pour faciliter le processus de candidature.</p>
        </div>
        
        <div class="options-container">
            <div class="option" id="uploadOption">
                <div class="option-icon">
                    <i class="fas fa-file-upload"></i>
                </div>
                <div class="option-content">
                    <h3>Télécharger mon CV</h3>
                    <p>Téléchargez votre CV au format PDF ou Word pour que nous puissions extraire vos informations automatiquement.</p>
                </div>
                <div class="option-arrow">
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
            
            <div class="option" id="manualOption">
                <div class="option-icon">
                    <i class="fas fa-edit"></i>
                </div>
                <div class="option-content">
                    <h3>Saisir mes informations manuellement</h3>
                    <p>Pas de CV disponible ? Pas de problème ! Vous pouvez saisir vos informations manuellement.</p>
                </div>
                <div class="option-arrow">
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
            
            <div class="option" id="skipOption">
                <div class="option-icon">
                    <i class="fas fa-forward"></i>
                </div>
                <div class="option-content">
                    <h3>Passer cette étape</h3>
                    <p>Vous préférez remplir directement le questionnaire ? Vous pourrez télécharger votre CV plus tard.</p>
                </div>
                <div class="option-arrow">
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
        </div>
        
        <div class="upload-container" id="uploadArea">
            <div class="alert alert-info">
                <div class="alert-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <div class="alert-content">
                    <div class="alert-title">Comment ça marche ?</div>
                    <div class="alert-text">Nous allons analyser votre CV pour en extraire les informations importantes comme vos compétences, votre expérience et votre formation. Vous pourrez ensuite vérifier et compléter ces informations.</div>
                </div>
            </div>
            
            <div class="file-upload-container">
                <input type="file" id="cvUpload" accept=".pdf,.doc,.docx" style="display: block; margin-bottom: 10px;">
                <label for="cvUpload" class="file-upload-label">
                    <div class="file-upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="file-upload-text">
                        <strong>Choisir un fichier</strong> ou glisser-déposer
                        <span>Formats acceptés : PDF, Word (.doc, .docx) • Max 5 Mo</span>
                    </div>
                </label>
                
                <div id="filePreview" class="file-preview">
                    <div class="file-preview-content">
                        <i class="fas fa-file-pdf file-icon"></i>
                        <div class="file-info">
                            <div id="fileName" class="file-name">document.pdf</div>
                            <div id="fileSize" class="file-size">2.4 MB • PDF</div>
                        </div>
                    </div>
                    <div class="file-preview-actions">
                        <button id="changeFileBtn" class="btn btn-text">Changer</button>
                        <button id="uploadBtn" class="btn btn-primary">Télécharger</button>
                    </div>
                </div>
                
                <div id="progressContainer" class="progress-container">
                    <div class="progress-text-wrapper">
                        <span>Analyse en cours...</span>
                        <span id="progressText">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                </div>
                
                <div id="resultContainer" class="result-container">
                    <div class="result-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="result-title">CV téléchargé avec succès</div>
                    <p class="result-text">Nous avons extrait les informations importantes de votre CV. Vous pourrez les compléter ou les modifier dans la prochaine étape.</p>
                    <div id="resultDetails" class="result-details">
                        <!-- Les données extraites seront affichées ici -->
                    </div>
                    <div class="result-actions">
                        <button id="continueBtn" class="btn btn-primary">Continuer</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <div id="footer"></div>
    
    <script src="../static/services/dataService.js"></script>
    <script src="../static/components/header.js"></script>
    <script src="../static/components/footer.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Vérifier si l'utilisateur est connecté
            const currentUser = dataService.getCurrentUser();
            if (!currentUser || currentUser.type !== 'candidate') {
                // Rediriger vers la page de connexion si l'utilisateur n'est pas connecté
                window.location.href = 'candidate-login.html';
                return;
            }
            
            // Éléments DOM
            const uploadOption = document.getElementById('uploadOption');
            const manualOption = document.getElementById('manualOption');
            const skipOption = document.getElementById('skipOption');
            const uploadArea = document.getElementById('uploadArea');
            const cvUpload = document.getElementById('cvUpload');
            const filePreview = document.getElementById('filePreview');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const changeFileBtn = document.getElementById('changeFileBtn');
            const uploadBtn = document.getElementById('uploadBtn');
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const resultContainer = document.getElementById('resultContainer');
            const resultDetails = document.getElementById('resultDetails');
            const continueBtn = document.getElementById('continueBtn');
            
            // Initialisation
            filePreview.style.display = 'none';
            progressContainer.style.display = 'none';
            resultContainer.style.display = 'none';
            uploadArea.style.display = 'none';
            
            // Événements
            uploadOption.addEventListener('click', function() {
                uploadArea.style.display = 'block';
                uploadOption.classList.add('active');
                manualOption.classList.remove('active');
                skipOption.classList.remove('active');
            });
            
            manualOption.addEventListener('click', function() {
                // Rediriger vers le formulaire manuel
                window.location.href = 'candidate-questionnaire.html';
            });
            
            skipOption.addEventListener('click', function() {
                // Rediriger vers le questionnaire
                window.location.href = 'candidate-questionnaire.html';
            });
            
            cvUpload.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    
                    // Vérifier le type de fichier
                    const validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
                    if (!validTypes.includes(file.type)) {
                        alert('Format de fichier non accepté. Veuillez télécharger un fichier PDF ou Word (.doc, .docx).');
                        return;
                    }
                    
                    // Vérifier la taille du fichier (max 5 Mo)
                    if (file.size > 5 * 1024 * 1024) {
                        alert('Le fichier est trop volumineux. Taille maximale autorisée : 5 Mo.');
                        return;
                    }
                    
                    // Afficher l'aperçu du fichier
                    fileName.textContent = file.name;
                    
                    // Formater la taille du fichier
                    let fileSizeText = '';
                    if (file.size < 1024 * 1024) {
                        fileSizeText = Math.round(file.size / 1024) + ' Ko';
                    } else {
                        fileSizeText = (file.size / (1024 * 1024)).toFixed(1) + ' Mo';
                    }
                    
                    // Déterminer le type de fichier
                    let fileTypeText = '';
                    if (file.type === 'application/pdf') {
                        fileTypeText = 'PDF';
                    } else if (file.type === 'application/msword') {
                        fileTypeText = 'DOC';
                    } else if (file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
                        fileTypeText = 'DOCX';
                    }
                    
                    fileSize.textContent = fileSizeText + ' • ' + fileTypeText;
                    filePreview.style.display = 'flex';
                }
            });
            
            changeFileBtn.addEventListener('click', function() {
                cvUpload.value = '';
                filePreview.style.display = 'none';
            });
            
            uploadBtn.addEventListener('click', function() {
                if (!cvUpload.files.length) {
                    alert('Veuillez sélectionner un fichier à télécharger.');
                    return;
                }
                
                // Simuler le téléchargement et l'analyse du CV
                filePreview.style.display = 'none';
                progressContainer.style.display = 'block';
                
                let progress = 0;
                const interval = setInterval(function() {
                    progress += 5;
                    progressFill.style.width = progress + '%';
                    progressText.textContent = progress + '%';
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                        
                        // Simuler l'extraction des données du CV
                        setTimeout(function() {
                            progressContainer.style.display = 'none';
                            resultContainer.style.display = 'block';
                            
                            // Afficher les données extraites (simulées)
                            resultDetails.innerHTML = `
                                <div class="detail-item">
                                    <span class="detail-label">Nom détecté :</span>
                                    <span class="detail-value">${currentUser.name}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Compétences détectées :</span>
                                    <span class="detail-value">JavaScript, React, Node.js, HTML, CSS</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Expérience détectée :</span>
                                    <span class="detail-value">4 ans</span>
                                </div>
                            `;
                            
                            // Mettre à jour le profil de l'utilisateur
                            dataService.saveCandidateProfile(currentUser.id, {
                                title: 'Développeur Full Stack',
                                skills: ['JavaScript', 'React', 'Node.js', 'HTML', 'CSS'],
                                experience: 4,
                                location: 'Paris',
                                hasCv: true
                            });
                        }, 1000);
                    }
                }, 100);
            });
            
            continueBtn.addEventListener('click', function() {
                // Rediriger vers le questionnaire
                window.location.href = 'candidate-questionnaire.html';
            });
        });
        
        function initAutocomplete() {
            // Cette fonction n'est pas implémentée dans cette version simplifiée
            console.log('Service d\'autocomplétion d\'adresses chargé');
        }
    </script>
</body>
</html>