<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexten - Chargement de CV</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- ORDRE CRITIQUE: PDF.js d'abord -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Configuration PDF.js immédiate
        if (window.pdfjsLib) {
            window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
            console.log('✅ PDF.js configuré pour multi-pages');
        }
    </script>
    
    <!-- Scripts de parsing CV - CHEMINS CORRIGÉS -->
    <script src="../static/scripts/data-transfer-service.js"></script>
    <script src="../static/js/optimized-openai-prompt.js"></script>
    <script src="../static/js/parser-integration.js"></script>
    <script src="../static/js/enhanced-cv-parser-multipage-fix.js"></script>
    <script src="../static/js/multipage-pdf-integration.js"></script>
    
    <style>
        /* Styles CSS existants (inchangés) */
        :root {
            --primary-color: #7c4dff;
            --primary-light: #e8e3ff;
            --gray-light: #f5f5f5;
            --gray-dark: #666;
            --text-color: #333;
            --border-radius: 8px;
            --success-color: #4CAF50;
            --success-light: #E8F5E9;
            --warning-color: #FF9800;
            --warning-light: #FFF3E0;
            --error-color: #F44336;
            --error-light: #FFEBEE;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #f8f9fa;
            color: var(--text-color);
            min-height: 100vh;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .logo {
            color: var(--text-color);
            font-weight: 700;
            text-decoration: none;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
        }

        .logo span {
            color: var(--primary-color);
        }

        .logo-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            font-size: 0.8rem;
            margin-left: 4px;
        }

        .nav {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            transition: color 0.2s;
        }

        .nav-link:hover {
            color: var(--primary-color);
        }

        .profile-btn {
            background-color: #f5f5f5;
            color: var(--primary-color);
            border: none;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .profile-btn:hover {
            background-color: #e8e3ff;
        }

        .main-content {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-color);
            text-align: center;
        }

        .page-subtitle {
            font-size: 1rem;
            color: var(--gray-dark);
            text-align: center;
            margin-bottom: 2rem;
            max-width: 600px;
            line-height: 1.5;
        }

        .ai-badge {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 0.5rem 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 1.5rem 0;
        }

        .questionnaire-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            width: 100%;
            margin-top: 1rem;
        }

        .stepper {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 2.5rem;
            padding: 0 3rem;
        }

        .stepper-line {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            height: 3px;
            background-color: #e0e0e0;
            width: 100%;
            z-index: 1;
        }

        .stepper-progress {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            height: 3px;
            background-color: var(--primary-color);
            width: 0%;
            z-index: 1;
            transition: width 0.3s;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .step-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 0.5rem;
            background-color: white;
            border: 2px solid #e0e0e0;
            color: #9e9e9e;
        }

        .step.active .step-number {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .step.completed .step-number {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .step-label {
            font-size: 0.875rem;
            color: var(--gray-dark);
            margin-top: 0.25rem;
        }

        .step.active .step-label {
            color: var(--primary-color);
            font-weight: 500;
        }

        .form-section-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #eee;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #6a3de8;
        }

        .btn-outline {
            background-color: white;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-light);
        }

        /* Styles spécifiques pour l'upload de CV */
        .upload-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            border: 2px dashed #ddd;
            border-radius: var(--border-radius);
            margin: 1.5rem 0;
            transition: all 0.3s;
            cursor: pointer;
            text-align: center;
        }

        .upload-container:hover {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .upload-text {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .upload-hint {
            font-size: 0.875rem;
            color: var(--gray-dark);
            margin-bottom: 1rem;
        }

        .file-input {
            display: none;
        }

        .file-info {
            display: none;
            flex-direction: column;
            align-items: center;
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: var(--primary-light);
            border-radius: var(--border-radius);
            width: 100%;
        }

        .file-name {
            font-weight: 500;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .file-size {
            font-size: 0.875rem;
            color: var(--gray-dark);
        }

        .remove-file {
            color: #d32f2f;
            cursor: pointer;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
            transition: color 0.2s;
        }

        .remove-file:hover {
            color: #b71c1c;
        }

        .loading-indicator {
            display: none;
            margin-top: 1.5rem;
            flex-direction: column;
            align-items: center;
        }

        .spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-bottom: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 0.875rem;
            color: var(--gray-dark);
        }

        .parsed-data {
            display: none;
            margin-top: 2rem;
            width: 100%;
        }

        .parsed-data-title {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .data-table th, .data-table td {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            text-align: left;
            line-height: 1.4;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table th {
            font-weight: 600;
            color: var(--primary-color);
            background-color: var(--primary-light);
            width: 30%;
        }

        .detected {
            color: var(--text-color);
        }

        .not-detected {
            color: #999;
            font-style: italic;
        }

        .success-message {
            display: none;
            background-color: var(--success-light);
            color: var(--success-color);
            padding: 1rem;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--success-color);
            margin-top: 1.5rem;
            text-align: center;
            animation: fadeIn 0.5s ease-in-out;
        }

        .or-divider {
            display: flex;
            align-items: center;
            width: 100%;
            margin: 1.5rem 0;
        }

        .or-divider::before, .or-divider::after {
            content: "";
            flex: 1;
            border-bottom: 1px solid #ddd;
        }

        .or-divider-text {
            margin: 0 1rem;
            color: var(--gray-dark);
            font-size: 0.875rem;
        }

        .error-message {
            display: none;
            background-color: var(--error-light);
            color: var(--error-color);
            padding: 1rem;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--error-color);
            margin-top: 1.5rem;
            text-align: center;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Styles pour le chat AI */
        .chat-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            cursor: pointer;
            margin-top: 1rem;
            transition: background-color 0.2s;
        }
        
        .chat-button:hover {
            background-color: #6a3de8;
        }
        
        .chat-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .chat-modal {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #eee;
            background-color: var(--primary-color);
            color: white;
        }
        
        .chat-header h3 {
            margin: 0;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .chat-close:hover {
            opacity: 0.8;
        }
        
        .chat-body {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        .chat-document {
            width: 300px;
            padding: 1rem;
            border-right: 1px solid #eee;
            background-color: #f8f9fa;
            overflow-y: auto;
        }
        
        .chat-document-title {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .chat-document-data {
            max-height: calc(80vh - 130px);
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.85rem;
            background-color: white;
            padding: 0.75rem;
            border-radius: var(--border-radius);
            border: 1px solid #eee;
        }
        
        .chat-messages-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .message {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            word-wrap: break-word;
        }
        
        .message.user {
            align-self: flex-end;
            background-color: var(--primary-color);
            color: white;
            border-bottom-right-radius: 0.25rem;
        }
        
        .message.assistant {
            align-self: flex-start;
            background-color: #f0f0f0;
            color: var(--text-color);
            border-bottom-left-radius: 0.25rem;
        }
        
        .typing-indicator {
            align-self: flex-start;
            background-color: #f0f0f0;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            border-bottom-left-radius: 0.25rem;
            color: var(--gray-dark);
            font-style: italic;
            margin-top: 0.5rem;
            display: none;
        }
        
        .chat-input-container {
            display: flex;
            gap: 0.5rem;
            padding: 1rem;
            border-top: 1px solid #eee;
        }
        
        .chat-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid #ddd;
            border-radius: 1.5rem;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .chat-input:focus {
            border-color: var(--primary-color);
        }
        
        .chat-send {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .chat-send:hover {
            background-color: #6a3de8;
        }
        
        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 0 1rem 1rem;
        }
        
        .suggestion {
            background-color: #f0f0f0;
            color: var(--gray-dark);
            border: none;
            border-radius: 1rem;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .suggestion:hover {
            background-color: var(--primary-light);
            color: var(--primary-color);
        }

        /* Style du conteneur API Key */
        .api-key-container {
            margin-bottom: 1.5rem;
            display: none;
            width: 100%;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            border: 1px dashed #ddd;
        }
        
        .api-key-title {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }
        
        .api-key-description {
            font-size: 0.875rem;
            color: var(--gray-dark);
            margin-bottom: 1rem;
        }
        
        .api-key-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            margin-bottom: 0.5rem;
        }
        
        .api-key-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }
        
        .api-key-save {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            cursor: pointer;
        }
        
        .api-key-cancel {
            background-color: white;
            color: var(--gray-dark);
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            cursor: pointer;
        }

        /* Styles pour les tags dans les compétences */
        .skills-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .skill-tag {
            background-color: var(--primary-light);
            color: var(--primary-color);
            border-radius: 1rem;
            padding: 0.35rem 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
        }

        .skill-tag i {
            margin-right: 0.3rem;
            font-size: 0.75rem;
        }

        /* Styles pour la liste des logiciels */
        .software-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .software-item {
            background-color: #f0f2f5;
            color: var(--gray-dark);
            border-radius: 1rem;
            padding: 0.35rem 0.75rem;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
        }

        .software-item i {
            margin-right: 0.3rem;
            font-size: 0.75rem;
        }

        /* Styles pour les langues */
        .language-list {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .language-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            background-color: #f8f9fa;
            padding: 0.5rem 0.75rem;
            border-radius: var(--border-radius);
            min-width: 120px;
        }

        .language-name {
            font-weight: 500;
            display: flex;
            align-items: center;
        }

        .language-name i {
            margin-right: 0.3rem;
            color: var(--primary-color);
        }

        .language-level {
            font-size: 0.875rem;
            color: var(--gray-dark);
            padding-left: 1.2rem;
        }

        /* Styles pour l'expérience */
        .experience-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .experience-item {
            padding: 0.75rem;
            border-left: 3px solid var(--primary-light);
            background-color: #f8f9fa;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            transition: all 0.2s ease;
        }

        .experience-item:hover {
            border-left-color: var(--primary-color);
            background-color: var(--primary-light);
            transform: translateX(3px);
        }

        .experience-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--primary-color);
        }

        .experience-company {
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
        }

        .experience-company i {
            margin-right: 0.3rem;
            font-size: 0.8rem;
            color: var(--gray-dark);
        }

        .experience-date {
            font-size: 0.875rem;
            color: var(--gray-dark);
            display: flex;
            align-items: center;
        }

        .experience-date i {
            margin-right: 0.3rem;
            font-size: 0.8rem;
        }

        /* Styles pour la notification d'information */
        .info-box {
            background-color: var(--primary-light);
            border-left: 4px solid var(--primary-color);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--gray-dark);
            line-height: 1.4;
        }

        .info-box i {
            color: var(--primary-color);
            font-size: 1.1rem;
            margin-top: 0.1rem;
        }

        /* Badge pour le parser optimisé */
        .parser-badge {
            background: linear-gradient(45deg, var(--primary-color), #9c27b0);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            margin-left: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .parser-badge i {
            font-size: 0.7rem;
        }

        /* Badge spécial pour multi-pages */
        .multipage-badge {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            margin-left: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .multipage-badge i {
            font-size: 0.7rem;
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            
            .stepper {
                padding: 0 1rem;
            }
            
            .questionnaire-card {
                padding: 1.5rem;
            }
            
            .form-actions {
                flex-direction: column;
                gap: 1rem;
            }
            
            .btn {
                width: 100%;
            }
            
            .chat-body {
                flex-direction: column;
            }
            
            .chat-document {
                width: 100%;
                max-height: 200px;
                border-right: none;
                border-bottom: 1px solid #eee;
            }

            .data-table th {
                width: 40%;
            }

            .language-list {
                gap: 0.5rem;
            }

            .language-item {
                min-width: auto;
                width: calc(50% - 0.25rem);
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="index.html" class="logo">
            nex<span>ten</span><div class="logo-badge">10</div>
        </a>
        
        <nav class="nav">
            <a href="index.html" class="nav-link">Accueil</a>
            <button class="profile-btn">
                <i class="fas fa-user"></i>
                Mon profil
            </button>
        </nav>
    </header>

    <div class="main-content">
        <h1 class="page-title">CHARGEZ VOTRE CV</h1>
        <p class="page-subtitle">Gagnez du temps en laissant notre système analyser votre CV pour pré-remplir votre profil.</p>
        
        <span class="ai-badge">
            <i class="fas fa-robot"></i>
            Parsing assisté par l'IA
            <span class="parser-badge">
                <i class="fas fa-lightning-bolt"></i>
                Optimisé v2.1
            </span>
            <span class="multipage-badge">
                <i class="fas fa-file-pdf"></i>
                Multi-pages ✅
            </span>
        </span>
        
        <div class="questionnaire-card">
            <div class="stepper">
                <div class="stepper-line"></div>
                <div class="stepper-progress"></div>
                
                <div class="step active">
                    <div class="step-number">1</div>
                    <div class="step-label">Parsing CV</div>
                </div>
                
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-label">Questionnaire</div>
                </div>
                
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-label">Matching</div>
                </div>
            </div>
            
            <h2 class="form-section-title">Analyse automatique de votre CV</h2>
            
            <p>Uploadez votre CV pour que nous puissions extraire automatiquement vos informations et compétences. <strong>Notre nouveau parser lit maintenant l'intégralité des CV multi-pages !</strong></p>
            
            <!-- Conteneur pour la clé API (initialement caché) -->
            <div class="api-key-container" id="apiKeyContainer">
                <div class="api-key-title">Clé API OpenAI (facultatif)</div>
                <div class="api-key-description">
                    Pour utiliser le parsing avancé sur GitHub Pages, vous pouvez fournir votre propre clé API OpenAI.
                    Votre clé ne sera jamais stockée sur nos serveurs et restera uniquement dans votre navigateur.
                </div>
                <input type="text" class="api-key-input" id="apiKeyInput" placeholder="sk-...">
                <div class="api-key-actions">
                    <button class="api-key-cancel" id="apiKeyCancelBtn">Annuler</button>
                    <button class="api-key-save" id="apiKeySaveBtn">Enregistrer</button>
                </div>
            </div>
            
            <div class="upload-container" id="uploadContainer">
                <i class="fas fa-file-upload upload-icon"></i>
                <p class="upload-text">Glissez votre CV ici ou cliquez pour parcourir</p>
                <p class="upload-hint">Formats acceptés: PDF, DOCX, DOC, JPG, PNG (taille max: 10MB)<br><strong>✨ CV multi-pages supportés !</strong></p>
                <input type="file" class="file-input" id="cvFile" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
            </div>
            
            <div class="file-info" id="fileInfo">
                <div class="file-name">
                    <i class="fas fa-file-alt"></i>
                    <span id="fileName">CV_Nom_Prenom.pdf</span>
                </div>
                <div class="file-size" id="fileSize">1.2 MB</div>
                <div class="remove-file" id="removeFile">
                    <i class="fas fa-trash-alt"></i>
                    Supprimer
                </div>
            </div>
            
            <div class="loading-indicator" id="loadingIndicator">
                <div class="spinner"></div>
                <p class="loading-text">Analyse CV multi-pages en cours...</p>
            </div>
            
            <div class="parsed-data" id="parsedData">
                <div class="parsed-data-title">
                    <i class="fas fa-check-circle"></i>
                    Informations extraites de votre CV
                    <span class="parser-badge">
                        <i class="fas fa-star"></i>
                        Précision améliorée
                    </span>
                    <span class="multipage-badge">
                        <i class="fas fa-file-pdf"></i>
                        Multi-pages OK ✅
                    </span>
                </div>

                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <p>Ces informations ont été extraites automatiquement avec notre parser multi-pages corrigé. <strong>Toutes les pages de votre CV ont été analysées !</strong> Vous pourrez les modifier et les compléter lors de l'étape suivante.</p>
                </div>
                
                <table class="data-table">
                    <tr>
                        <th>Nom complet</th>
                        <td id="parsedName" class="detected">John Doe</td>
                    </tr>
                    <tr>
                        <th>Titre de poste actuel</th>
                        <td id="parsedJobTitle" class="detected">Développeur Front-End</td>
                    </tr>
                    <tr>
                        <th>Email</th>
                        <td id="parsedEmail" class="detected">john.doe@exemple.com</td>
                    </tr>
                    <tr>
                        <th>Téléphone</th>
                        <td id="parsedPhone" class="detected">+33 6 12 34 56 78</td>
                    </tr>
                    <tr>
                        <th>Compétences détectées</th>
                        <td id="parsedSkills">
                            <div class="skills-tags">
                                <span class="skill-tag"><i class="fas fa-check-circle"></i>HTML</span>
                                <span class="skill-tag"><i class="fas fa-check-circle"></i>CSS</span>
                                <span class="skill-tag"><i class="fas fa-check-circle"></i>JavaScript</span>
                                <span class="skill-tag"><i class="fas fa-check-circle"></i>React</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>Logiciels maîtrisés</th>
                        <td id="parsedSoftware">
                            <div class="software-list">
                                <span class="software-item"><i class="fas fa-laptop-code"></i>Visual Studio Code</span>
                                <span class="software-item"><i class="fas fa-pencil-ruler"></i>Adobe Photoshop</span>
                                <span class="software-item"><i class="fas fa-paint-brush"></i>Figma</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>Langues</th>
                        <td id="parsedLanguages">
                            <div class="language-list">
                                <div class="language-item">
                                    <span class="language-name"><i class="fas fa-language"></i>Français</span>
                                    <span class="language-level">Natif</span>
                                </div>
                                <div class="language-item">
                                    <span class="language-name"><i class="fas fa-language"></i>Anglais</span>
                                    <span class="language-level">Courant</span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>Expérience professionnelle</th>
                        <td id="parsedExperience">
                            <div class="experience-list">
                                <div class="experience-item">
                                    <div class="experience-title">Développeur Front-End</div>
                                    <div class="experience-company"><i class="fas fa-building"></i>TechCorp</div>
                                    <div class="experience-date"><i class="fas fa-calendar-alt"></i>Jan 2022 - Présent</div>
                                </div>
                                <div class="experience-item">
                                    <div class="experience-title">Développeur Web Junior</div>
                                    <div class="experience-company"><i class="fas fa-building"></i>WebAgency</div>
                                    <div class="experience-date"><i class="fas fa-calendar-alt"></i>Mar 2020 - Déc 2021</div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
                
                <!-- Bouton pour ouvrir le chat avec l'IA -->
                <button class="chat-button" id="openChatBtn">
                    <i class="fas fa-comment-dots"></i>
                    Discuter de mon CV avec l'IA
                </button>
            </div>
            
            <div class="success-message" id="successMessage">
                <i class="fas fa-check-circle"></i>
                Analyse terminée avec succès!
            </div>
            
            <div class="error-message" id="errorMessage">
                <i class="fas fa-exclamation-circle"></i>
                <span id="errorText">Une erreur est survenue lors de l'analyse.</span>
            </div>
            
            <div class="or-divider">
                <div class="or-divider-text">OU</div>
            </div>
            
            <p style="text-align: center; margin-bottom: 1rem;">Vous préférez remplir manuellement votre profil ?</p>
            
            <div class="form-actions">
                <button type="button" class="btn btn-outline" id="skipBtn">Passer cette étape</button>
                <button type="button" class="btn btn-primary" id="nextBtn">Continuer</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de chat avec l'IA -->
    <div class="chat-modal-overlay" id="chatModalOverlay">
        <div class="chat-modal">
            <div class="chat-header">
                <h3><i class="fas fa-robot"></i> Assistant d'analyse de CV - Multi-pages</h3>
                <button class="chat-close" id="closeChatBtn">&times;</button>
            </div>
            <div class="chat-body">
                <div class="chat-document">
                    <div class="chat-document-title">
                        <i class="fas fa-file-alt"></i>
                        Données extraites
                    </div>
                    <div class="chat-document-data" id="chatDocumentData">
                        <!-- Les données extraites du CV seront affichées ici -->
                    </div>
                </div>
                <div class="chat-messages-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="message assistant">
                            Bonjour ! Je suis votre assistant IA avec support multi-pages. J'ai analysé l'intégralité de votre CV avec notre nouveau parser corrigé et je peux répondre à vos questions ou vous fournir des conseils pour l'améliorer. Comment puis-je vous aider ?
                        </div>
                    </div>
                    <div class="typing-indicator" id="chatTypingIndicator">
                        L'assistant est en train d'écrire...
                    </div>
                    <div class="suggestions">
                        <button class="suggestion">Comment puis-je améliorer mon CV ?</button>
                        <button class="suggestion">Quelles sont mes forces ?</button>
                        <button class="suggestion">Tester le CV de Sabine multi-pages</button>
                        <button class="suggestion">Quels types d'emploi me correspondent ?</button>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" class="chat-input" id="chatInput" placeholder="Posez une question sur votre CV...">
                        <button class="chat-send" id="chatSendBtn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="cv-parser-integration.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Commitment Parser CV Multi-pages v2.1 - Chargement critique...');
            
            // ÉTAPE 1: Vérifier le chargement des dépendances critiques
            const checkDependencies = () => {
                const deps = {
                    pdfjs: typeof window.pdfjsLib !== 'undefined',
                    enhancedParser: typeof window.EnhancedCVParserMultipage !== 'undefined',
                    multipageParser: typeof window.commitmentMultipageParser !== 'undefined'
                };
                
                console.log('📋 État des dépendances:', deps);
                return deps;
            };
            
            // ÉTAPE 2: Initialisation forcée du parser
            const initializeParser = () => {
                console.log('🔧 Initialisation forcée du parser multi-pages...');
                
                // Vérifier PDF.js
                if (typeof window.pdfjsLib !== 'undefined') {
                    console.log('✅ PDF.js chargé et configuré');
                } else {
                    console.warn('⚠️ PDF.js non disponible - fallback activé');
                }
                
                // Forcer l'initialisation du parser multi-pages
                if (typeof window.EnhancedCVParserMultipage !== 'undefined') {
                    window.commitmentMultipageParser = new window.EnhancedCVParserMultipage();
                    console.log('✅ Parser multi-pages initialisé');
                } else {
                    console.error('❌ EnhancedCVParserMultipage non disponible');
                    return false;
                }
                
                return true;
            };
            
            // ÉTAPE 3: Configuration des fonctions de test
            const setupTestFunctions = () => {
                // Test rapide Sabine multi-pages
                window.testSabineMultipageCV = function() {
                    console.log('🧪 Test CV Sabine Rivière (multi-pages)...');
                    
                    if (!window.commitmentMultipageParser) {
                        console.error('❌ Parser multi-pages non disponible');
                        return;
                    }
                    
                    // Créer un mock file avec le contenu complet de Sabine
                    const sabineContent = `Sabine Rivière
Executive Assistant

E-mail: sabine.riviere04@gmail.com
Téléphone: +33665733921

EXPÉRIENCE PROFESSIONNELLE

06/2024 - 01/2025
Executive Assistant : Direction Financière Audit / Fiscalité / Trésorerie
Maison Christian Dior Couture : Intérim 8 mois, Paris 08

06/2023 - 05/2024
EXECUTIVE ASSISTANT : Direction Fonds de Fonds COMEX / CODIR / CMG
BPI FRANCE, Paris

08/2019 - 05/2023
EXECUTIVE ASSISTANT/ ASSISTANTE PERSONNELLE de la CEO
Les Secrets de Loly, Paris

--- PAGE 2 ---

02/2017 - 07/2019
ASSISTANTE DIRECTION GÉNÉRALE
Groupe Marcel Dassault, Neuilly-sur-Seine

01/2015 - 01/2017
ASSISTANTE DE DIRECTION
Cabinet d'avocats Clifford Chance, Paris

09/2010 - 12/2014
EXECUTIVE ASSISTANT
BNP Paribas Corporate & Investment Banking, Londres

COMPÉTENCES
• Tenue d'agendas
• Suivi budgétaire
• Préparation de rapports
• Sens de la communication
• Excellente organisation du travail

INFORMATIQUE
• Microsoft
• Concur
• Coupa
• SAP
• Pennylane
• Google / Outlook

LANGUES
• Français - Natif
• Anglais - Courant

FORMATION
2006 - DIPLÔME D'ÉTUDES SUPÉRIEURES ESVE, Paris
2014 - Business & Economics, BA Birkbeck University, London`;
                    
                    // Simuler un fichier
                    const mockFile = new Blob([sabineContent], { type: 'text/plain' });
                    mockFile.name = 'CV_Sabine_Riviere.txt';
                    mockFile.type = 'text/plain';
                    
                    // Parser le contenu
                    try {
                        const result = window.commitmentMultipageParser.parseCV ?
                            window.commitmentMultipageParser.parseCV(mockFile) :
                            { error: 'Parser non disponible' };
                        
                        console.log('📊 Résultat test multi-pages:', result);
                        
                        // Vérifications spécifiques
                        if (result.data) {
                            const experiences = result.data.work_experience || [];
                            console.log(`📋 Expériences détectées: ${experiences.length}`);
                            
                            // Vérifier expériences page 2
                            const hasMarcelDassault = experiences.some(exp => 
                                exp.company?.toLowerCase().includes('marcel dassault'));
                            const hasCliffordChance = experiences.some(exp => 
                                exp.company?.toLowerCase().includes('clifford chance'));
                            const hasBNP = experiences.some(exp => 
                                exp.company?.toLowerCase().includes('bnp paribas'));
                            
                            console.log('🎯 Vérifications page 2:');
                            console.log(`- Marcel Dassault: ${hasMarcelDassault ? '✅' : '❌'}`);
                            console.log(`- Clifford Chance: ${hasCliffordChance ? '✅' : '❌'}`);
                            console.log(`- BNP Paribas: ${hasBNP ? '✅' : '❌'}`);
                            
                            const score = [hasMarcelDassault, hasCliffordChance, hasBNP].filter(Boolean).length;
                            console.log(`🏆 Score multi-pages: ${score}/3 (${Math.round(score/3*100)}%)`);
                            
                            if (score >= 2) {
                                console.log('✅ TEST MULTI-PAGES RÉUSSI !');
                            } else {
                                console.log('❌ Test multi-pages échoué - Page 2 non lue');
                            }
                        }
                        
                        return result;
                    } catch (error) {
                        console.error('❌ Erreur test multi-pages:', error);
                        return null;
                    }
                };
                
                console.log('✅ Fonctions de test configurées');
            };
            
            // ÉTAPE 4: Démarrage avec retry
            let initAttempts = 0;
            const maxAttempts = 5;
            
            const attemptInitialization = () => {
                initAttempts++;
                console.log(`🔄 Tentative d'initialisation ${initAttempts}/${maxAttempts}...`);
                
                const deps = checkDependencies();
                
                if (deps.enhancedParser || initAttempts >= maxAttempts) {
                    if (initializeParser()) {
                        setupTestFunctions();
                        
                        // Message de confirmation
                        console.log('🎉 PARSER MULTI-PAGES ACTIVÉ AVEC SUCCÈS !');
                        console.log('📚 Toutes les pages PDF seront maintenant lues');
                        console.log('🧪 Test disponible: testSabineMultipageCV()');
                        
                        // Mise à jour visuelle
                        const loadingText = document.querySelector('.loading-text');
                        if (loadingText) {
                            loadingText.textContent = 'Parser multi-pages activé ✅';
                        }
                        
                        // Ajouter badge de statut
                        const multipageBadge = document.querySelector('.multipage-badge');
                        if (multipageBadge) {
                            multipageBadge.innerHTML = '<i class="fas fa-check-circle"></i> Multi-pages ✅';
                        }
                        
                    } else {
                        console.error('❌ Échec initialisation parser multi-pages');
                    }
                    return;
                }
                
                // Retry dans 500ms
                setTimeout(attemptInitialization, 500);
            };
            
            // Démarrer l'initialisation
            setTimeout(attemptInitialization, 100);
            
            // Gestionnaire de clic pour test Sabine
            const setupSabineTestButton = () => {
                const suggestionBtns = document.querySelectorAll('.suggestion');
                suggestionBtns.forEach(btn => {
                    if (btn.textContent.includes('Tester le CV de Sabine')) {
                        btn.addEventListener('click', function() {
                            if (typeof window.testSabineMultipageCV === 'function') {
                                window.testSabineMultipageCV();
                            } else {
                                console.log('❌ Fonction de test non disponible');
                            }
                        });
                    }
                });
            };
            
            setTimeout(setupSabineTestButton, 1000);
        });
    </script>
</body>
</html>