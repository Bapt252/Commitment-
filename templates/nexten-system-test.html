<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXTEN System - Test Complet 100%</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .status-item {
            text-align: center;
            flex: 1;
        }
        
        .status-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .status-label {
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .test-section {
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #dee2e6;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #56ab2f, #a8e6cf);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .results {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            min-height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 500px;
            border: 1px solid #dee2e6;
        }
        
        .score-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .score-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }
        
        .score-card h3 {
            margin-bottom: 10px;
            color: #333;
            font-size: 1rem;
        }
        
        .score-card .score {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .score-card .weight {
            font-size: 0.8rem;
            color: #666;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        
        .engines-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .engine-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e9ecef;
        }
        
        .engine-card.loaded {
            border-color: #28a745;
            background: #f8fff8;
        }
        
        .engine-card.error {
            border-color: #dc3545;
            background: #fff8f8;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üöÄ NEXTEN SYSTEM</h1>
            <div class="subtitle">Syst√®me de Matching RH R√©volutionnaire - 100% Complet</div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-item">
                <div class="status-value" id="system-status">-</div>
                <div class="status-label">Statut Syst√®me</div>
            </div>
            <div class="status-item">
                <div class="status-value" id="engines-loaded">0/5</div>
                <div class="status-label">Moteurs Charg√©s</div>
            </div>
            <div class="status-item">
                <div class="status-value" id="performance">-</div>
                <div class="status-label">Performance</div>
            </div>
            <div class="status-item">
                <div class="status-value" id="cache-rate">-</div>
                <div class="status-label">Cache Hit Rate</div>
            </div>
        </div>

        <!-- Engines Status -->
        <div class="test-section">
            <h2 class="section-title">üîß Statut des Moteurs</h2>
            <div class="engines-status">
                <div class="engine-card" id="engine-semantic">
                    <strong>S√©mantique</strong><br>
                    <small>Crit√®re #1 (25%)</small>
                </div>
                <div class="engine-card" id="engine-commute">
                    <strong>Trajets</strong><br>
                    <small>Crit√®re #2 (20%)</small>
                </div>
                <div class="engine-card" id="engine-experience">
                    <strong>Exp√©rience</strong><br>
                    <small>Crit√®re #3 (20%)</small>
                </div>
                <div class="engine-card" id="engine-cultural">
                    <strong>Culture</strong><br>
                    <small>Crit√®re #4 (15%)</small>
                </div>
                <div class="engine-card" id="engine-availability">
                    <strong>Disponibilit√©</strong><br>
                    <small>Crit√®re #5 (10%)</small>
                </div>
            </div>
        </div>

        <!-- Tests Section -->
        <div class="test-section">
            <h2 class="section-title">üß™ Tests du Syst√®me</h2>
            <div class="buttons">
                <button class="btn btn-primary" onclick="runCompleteTest()">
                    Test Complet Doroth√©e Lim
                </button>
                <button class="btn btn-secondary" onclick="runPerformanceTest()">
                    Test Performance
                </button>
                <button class="btn btn-warning" onclick="runStressTest()">
                    Test Stress (100x)
                </button>
                <button class="btn btn-success" onclick="runCustomTest()">
                    Test Personnalis√©
                </button>
            </div>
            <div class="results" id="test-results">
Pr√™t pour les tests syst√®me Nexten...

Moteurs disponibles:
- ‚úÖ Commute Optimizer (Crit√®re #2)
- ‚úÖ Experience Level Matcher (Crit√®re #3) 
- ‚úÖ Cultural Fit Analyzer (Crit√®re #4)
- ‚úÖ Availability Optimizer (Crit√®re #5)
- ‚úÖ Unified System (Orchestrateur 100%)
- ‚úÖ System Tests (Validation compl√®te)

Cliquez sur un bouton pour commencer les tests...
            </div>
        </div>

        <!-- Results Display -->
        <div class="test-section" id="results-section" style="display: none;">
            <h2 class="section-title">üìä R√©sultats du Matching</h2>
            <div class="score-display" id="score-display">
                <!-- Les r√©sultats appara√Ætront ici -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/engines/commute-optimizer.js"></script>
    <script src="js/engines/experience-level-matcher.js"></script>
    <script src="js/engines/cultural-fit-analyzer.js"></script>
    <script src="js/engines/availability-optimizer.js"></script>
    <script src="js/engines/nexten-unified-system.js"></script>
    <script src="js/engines/nexten-system-tests.js"></script>

    <script>
        // Variables globales
        let nextenSystem = null;
        let nextenTests = null;
        let enginesLoaded = 0;

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Initialisation NEXTEN System...');
            checkEngines();
            
            // Tentative d'initialisation
            setTimeout(initializeSystem, 1000);
        });

        function checkEngines() {
            const engines = {
                'engine-commute': typeof CommuteOptimizer !== 'undefined',
                'engine-experience': typeof ExperienceLevelMatcher !== 'undefined',
                'engine-cultural': typeof CulturalFitAnalyzer !== 'undefined',
                'engine-availability': typeof AvailabilityOptimizer !== 'undefined',
                'engine-semantic': false // Sera charg√© depuis nexten-compatibility-engine.js
            };

            enginesLoaded = 0;
            Object.entries(engines).forEach(([id, loaded]) => {
                const element = document.getElementById(id);
                if (loaded) {
                    element.classList.add('loaded');
                    enginesLoaded++;
                } else {
                    element.classList.add('error');
                }
            });

            document.getElementById('engines-loaded').textContent = `${enginesLoaded}/5`;
        }

        function initializeSystem() {
            try {
                if (typeof NextenUnifiedSystem !== 'undefined') {
                    nextenSystem = new NextenUnifiedSystem();
                    document.getElementById('system-status').textContent = '‚úÖ OK';
                    document.getElementById('system-status').className = 'status-value success';
                    log('‚úÖ Syst√®me Nexten initialis√© avec succ√®s');
                } else {
                    throw new Error('NextenUnifiedSystem non disponible');
                }

                if (typeof NextenSystemTests !== 'undefined') {
                    nextenTests = new NextenSystemTests();
                    log('‚úÖ Tests syst√®me charg√©s');
                } else {
                    throw new Error('NextenSystemTests non disponible');
                }

                updateSystemStatus();
            } catch (error) {
                document.getElementById('system-status').textContent = '‚ùå ERROR';
                document.getElementById('system-status').className = 'status-value error';
                log(`‚ùå Erreur initialisation: ${error.message}`);
            }
        }

        function updateSystemStatus() {
            if (nextenSystem) {
                const health = nextenSystem.getSystemHealthStatus();
                const report = nextenSystem.getGlobalPerformanceReport();
                
                document.getElementById('performance').textContent = report.global.averageCalculationTime || '-';
                document.getElementById('cache-rate').textContent = report.global.cacheHitRate || '-';
            }
        }

        async function runCompleteTest() {
            if (!nextenTests) {
                log('‚ùå Tests non disponibles');
                return;
            }

            log('üß™ D√©marrage test complet...');
            addLoading();

            try {
                const result = await nextenTests.runCompleteSystemTest();
                
                if (result.success) {
                    log(`‚úÖ Test r√©ussi en ${result.executionTime.toFixed(1)}ms`);
                    displayResults(result.result);
                } else {
                    log(`‚ùå Test √©chou√©: ${result.error || 'Erreur inconnue'}`);
                }
            } catch (error) {
                log(`‚ùå Erreur test: ${error.message}`);
            } finally {
                removeLoading();
                updateSystemStatus();
            }
        }

        async function runPerformanceTest() {
            if (!nextenSystem) {
                log('‚ùå Syst√®me non initialis√©');
                return;
            }

            log('üèÉ‚Äç‚ôÇÔ∏è Test de performance...');
            addLoading();

            try {
                const candidate = nextenTests.getTestCandidateProfile();
                const job = nextenTests.getTestJobOffer();
                const company = nextenTests.getTestCompanyData();

                const iterations = 5;
                const times = [];

                for (let i = 0; i < iterations; i++) {
                    const start = performance.now();
                    await nextenSystem.calculateCompleteMatchingScore(candidate, job, company);
                    const end = performance.now();
                    times.push(end - start);
                    
                    log(`  It√©ration ${i + 1}: ${(end - start).toFixed(1)}ms`);
                }

                const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
                log(`üìä Performance moyenne: ${avgTime.toFixed(1)}ms`);
                log(`‚ö° Plus rapide: ${Math.min(...times).toFixed(1)}ms`);
                log(`üêå Plus lent: ${Math.max(...times).toFixed(1)}ms`);

            } catch (error) {
                log(`‚ùå Erreur performance test: ${error.message}`);
            } finally {
                removeLoading();
            }
        }

        async function runStressTest() {
            if (!nextenTests) {
                log('‚ùå Tests non disponibles');
                return;
            }

            log('üî• Test de stress (100 it√©rations)...');
            addLoading();

            try {
                const result = await nextenTests.runStressTest(100);
                
                log(`‚úÖ Stress test termin√©`);
                log(`üìä Succ√®s: ${result.results.length}/100`);
                log(`‚ùå Erreurs: ${result.errors.length}/100`);
                log(`‚è±Ô∏è Temps moyen: ${result.avgTime.toFixed(1)}ms`);
                log(`üéØ Cache hit rate: ${(result.cacheHitRate * 100).toFixed(1)}%`);

            } catch (error) {
                log(`‚ùå Erreur stress test: ${error.message}`);
            } finally {
                removeLoading();
            }
        }

        async function runCustomTest() {
            log('üîß Test personnalis√© - Utiliser la console pour donn√©es custom');
            log('Exemple:');
            log('const result = await nextenSystem.calculateCompleteMatchingScore(candidateData, jobData, companyData);');
            log('console.log(result);');
        }

        function displayResults(result) {
            document.getElementById('results-section').style.display = 'block';
            
            const scoreDisplay = document.getElementById('score-display');
            scoreDisplay.innerHTML = `
                <div class="score-card">
                    <h3>Score Final</h3>
                    <div class="score">${(result.finalScore * 100).toFixed(1)}%</div>
                    <div class="weight">${result.qualityLevel}</div>
                </div>
                <div class="score-card">
                    <h3>S√©mantique</h3>
                    <div class="score">${(result.criteriaBreakdown.semantic.score * 100).toFixed(1)}%</div>
                    <div class="weight">Poids: 25%</div>
                </div>
                <div class="score-card">
                    <h3>Trajets</h3>
                    <div class="score">${(result.criteriaBreakdown.commute.score * 100).toFixed(1)}%</div>
                    <div class="weight">Poids: 20%</div>
                </div>
                <div class="score-card">
                    <h3>Exp√©rience</h3>
                    <div class="score">${(result.criteriaBreakdown.experience.score * 100).toFixed(1)}%</div>
                    <div class="weight">Poids: 20%</div>
                </div>
                <div class="score-card">
                    <h3>Culture</h3>
                    <div class="score">${(result.criteriaBreakdown.cultural.score * 100).toFixed(1)}%</div>
                    <div class="weight">Poids: 15%</div>
                </div>
                <div class="score-card">
                    <h3>Disponibilit√©</h3>
                    <div class="score">${(result.criteriaBreakdown.availability.score * 100).toFixed(1)}%</div>
                    <div class="weight">Poids: 10%</div>
                </div>
                <div class="score-card">
                    <h3>Bonus</h3>
                    <div class="score">${(result.criteriaBreakdown.bonus.score * 100).toFixed(1)}%</div>
                    <div class="weight">Poids: 10%</div>
                </div>
            `;

            // Afficher les recommandations
            if (result.insights && result.insights.recommendations) {
                log('\nüìù Recommandations:');
                result.insights.recommendations.forEach(rec => {
                    log(`  ${rec.priority}: ${rec.message}`);
                });
            }

            // M√©triques de performance
            if (result.performance) {
                log(`\n‚è±Ô∏è Performance: ${result.performance.calculationTime.toFixed(1)}ms`);
                log(`üìä Qualit√© donn√©es: ${(result.performance.dataQuality * 100).toFixed(1)}%`);
                log(`üéØ Consistance: ${(result.performance.consistencyScore * 100).toFixed(1)}%`);
            }
        }

        function log(message) {
            const results = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            results.textContent += `[${timestamp}] ${message}\n`;
            results.scrollTop = results.scrollHeight;
        }

        function addLoading() {
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(btn => {
                btn.disabled = true;
                if (!btn.querySelector('.loading')) {
                    btn.insertAdjacentHTML('afterbegin', '<span class="loading"></span>');
                }
            });
        }

        function removeLoading() {
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(btn => {
                btn.disabled = false;
                const loading = btn.querySelector('.loading');
                if (loading) loading.remove();
            });
        }

        // Auto-test si param√®tre URL
        if (window.location.search.includes('test=nexten')) {
            window.addEventListener('load', () => {
                setTimeout(runCompleteTest, 2000);
            });
        }

        // Exposition globale pour debug
        window.nextenSystem = nextenSystem;
        window.nextenTests = nextenTests;
    </script>
</body>
</html>
