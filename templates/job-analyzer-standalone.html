<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyseur de Fiches de Poste - Version Standalone</title>
    
    <!-- Inclusion des bibliothèques CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        :root {
            --primary: #7c3aed;
            --primary-light: #9f65ff;
            --primary-dark: #5b21b6;
            --gray: #6b7280;
            --gray-light: #e5e7eb;
            --gray-dark: #374151;
            --gray-lightest: #f3f4f6;
            --success: #10b981;
            --error: #ef4444;
            --info: #3b82f6;
            --warning: #f59e0b;
            --blue: #3b82f6;
            
            --border-radius: 8px;
            --transition: all 0.2s ease-in-out;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.5;
            color: #333;
            background-color: #f9fafb;
            padding: 0;
            margin: 0;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .header {
            position: relative;
            padding: 2.5rem 0;
            margin-bottom: 2rem;
            overflow: hidden;
            border-radius: var(--border-radius);
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.05), rgba(124, 58, 237, 0.1));
            text-align: center;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }
        
        .header h1 {
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
            font-weight: 700;
            color: #333;
            font-size: 2rem;
        }
        
        .header .subtitle {
            max-width: 700px;
            font-size: 1.1rem;
            color: var(--gray);
            line-height: 1.6;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            padding: 2rem;
        }
        
        .drop-zone {
            border: 2px dashed var(--primary-light);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            background-color: rgba(124, 58, 237, 0.02);
            transition: var(--transition);
            cursor: pointer;
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        .drop-zone:hover,
        .drop-zone.drag-active {
            border-color: var(--primary);
            background-color: rgba(124, 58, 237, 0.05);
        }
        
        .drop-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
            transition: transform 0.3s ease;
        }
        
        .drop-zone:hover .drop-icon {
            transform: translateY(-5px);
        }
        
        .drop-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--gray-dark);
        }
        
        .drop-hint {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .file-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .separator {
            display: flex;
            align-items: center;
            margin: 1.5rem 0;
            color: var(--gray);
        }
        
        .separator .line {
            flex-grow: 1;
            height: 1px;
            background-color: var(--gray-light);
        }
        
        .separator .text {
            padding: 0 1rem;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .textarea-container {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .textarea-container textarea {
            width: 100%;
            min-height: 150px;
            padding: 1rem;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            resize: vertical;
            font-family: inherit;
            font-size: 0.95rem;
            transition: var(--transition);
        }
        
        .textarea-container textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }
        
        .button-container {
            display: flex;
            justify-content: center;
            margin: 1.5rem 0;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 1rem;
            border: none;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(124, 58, 237, 0.3);
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(124, 58, 237, 0.4);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
            box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);
        }
        
        .btn-success:hover {
            background-color: #059669;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(16, 185, 129, 0.4);
        }
        
        .loading-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
        }
        
        .loader {
            border: 3px solid var(--gray-lightest);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1.5s linear infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: var(--gray);
            font-weight: 500;
        }
        
        .result-container {
            display: none;
            background-color: var(--gray-lightest);
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 2rem;
            border-left: 4px solid var(--success);
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .result-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .result-header i {
            color: var(--success);
            font-size: 1.5rem;
            margin-right: 0.75rem;
        }
        
        .result-header h3 {
            font-weight: 600;
            color: var(--gray-dark);
            margin: 0;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .result-item {
            margin-bottom: 1.5rem;
        }
        
        .result-item.full-width {
            grid-column: 1 / -1;
        }
        
        .result-label {
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--gray);
            margin-bottom: 0.5rem;
            letter-spacing: 0.5px;
            display: block;
        }
        
        .result-value {
            background-color: white;
            padding: 0.75rem;
            border-radius: 6px;
            border: 1px solid var(--gray-light);
            font-size: 0.95rem;
            min-height: 2.5rem;
        }
        
        .skills-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .tag {
            display: inline-block;
            background-color: rgba(124, 58, 237, 0.1);
            color: var(--primary-dark);
            border-radius: 16px;
            padding: 0.4rem 0.8rem;
            font-size: 0.875rem;
            font-weight: 500;
            line-height: 1;
        }
        
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: none;
            align-items: center;
            background-color: white;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            padding: 1rem;
            z-index: 1000;
            max-width: 400px;
            transform: translateY(20px);
            transition: transform 0.3s ease, opacity 0.3s ease;
            overflow: hidden;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
            display: flex;
        }
        
        .notification::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 5px;
        }
        
        .notification.success::before {
            background-color: var(--success);
        }
        
        .notification.error::before {
            background-color: var(--error);
        }
        
        .notification.info::before {
            background-color: var(--info);
        }
        
        .notification-icon {
            margin-right: 1rem;
            font-size: 1.5rem;
        }
        
        .notification.success .notification-icon {
            color: var(--success);
        }
        
        .notification.error .notification-icon {
            color: var(--error);
        }
        
        .notification.info .notification-icon {
            color: var(--info);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .notification-message {
            color: var(--gray);
            font-size: 0.95rem;
        }
        
        .notification-close {
            margin-left: 1rem;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
        }
        
        .notification-close:hover {
            color: var(--gray-dark);
            transform: scale(1.1);
        }
        
        .file-badge {
            display: none;
            align-items: center;
            background-color: white;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 1rem;
            animation: fadeIn 0.3s ease;
            border: 1px solid var(--gray-light);
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .file-badge i {
            margin-right: 0.5rem;
            color: var(--primary);
        }
        
        .file-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--gray-dark);
            font-weight: 500;
            margin-right: 0.5rem;
        }
        
        .remove-button {
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .remove-button:hover {
            color: var(--error);
            transform: scale(1.1);
        }
        
        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.75rem;
            }
            
            .header .subtitle {
                font-size: 1rem;
            }
            
            .card {
                padding: 1.5rem;
            }
            
            .result-grid {
                grid-template-columns: 1fr;
            }
            
            .notification {
                left: 20px;
                right: 20px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Analysez votre fiche de poste</h1>
            <p class="subtitle">Un outil simple et rapide pour extraire automatiquement les informations clés de votre fiche de poste</p>
        </header>
        
        <main>
            <div class="card">
                <div class="drop-zone" id="dropZone">
                    <i class="fas fa-file-upload drop-icon"></i>
                    <h3 class="drop-title">Glissez-déposez votre fiche de poste ici</h3>
                    <p class="drop-hint">Formats acceptés: PDF, DOCX, TXT (max 5MB)</p>
                    <input type="file" id="fileInput" class="file-input" accept=".pdf,.doc,.docx,.txt">
                    
                    <div id="fileBadge" class="file-badge">
                        <i class="fas fa-file-alt"></i>
                        <span id="fileName" class="file-name">nom-du-fichier.pdf</span>
                        <i class="fas fa-times remove-button" id="removeFile"></i>
                    </div>
                </div>
                
                <div class="button-container">
                    <button type="button" id="analyzeBtn" class="btn btn-primary">
                        <i class="fas fa-robot"></i> Analyser la fiche de poste
                    </button>
                </div>
                
                <div class="separator">
                    <div class="line"></div>
                    <div class="text">OU</div>
                    <div class="line"></div>
                </div>
                
                <div class="textarea-container">
                    <textarea id="jobText" placeholder="Collez le texte de votre fiche de poste ici pour une analyse automatique..."></textarea>
                </div>
                
                <div class="button-container">
                    <button type="button" id="analyzeTextBtn" class="btn btn-primary">
                        <i class="fas fa-search"></i> Analyser le texte
                    </button>
                </div>
                
                <div id="loadingContainer" class="loading-container">
                    <div class="loader"></div>
                    <span class="loading-text">Analyse en cours...</span>
                </div>
                
                <div id="resultContainer" class="result-container">
                    <div class="result-header">
                        <i class="fas fa-check-circle"></i>
                        <h3>Informations extraites</h3>
                    </div>
                    
                    <div class="result-grid">
                        <div class="result-item">
                            <label class="result-label">Titre du poste</label>
                            <div id="jobTitle" class="result-value">Non spécifié</div>
                        </div>
                        
                        <div class="result-item">
                            <label class="result-label">Type de contrat</label>
                            <div id="contractType" class="result-value">Non spécifié</div>
                        </div>
                        
                        <div class="result-item">
                            <label class="result-label">Lieu</label>
                            <div id="location" class="result-value">Non spécifié</div>
                        </div>
                        
                        <div class="result-item">
                            <label class="result-label">Expérience requise</label>
                            <div id="experience" class="result-value">Non spécifié</div>
                        </div>
                        
                        <div class="result-item">
                            <label class="result-label">Formation</label>
                            <div id="education" class="result-value">Non spécifié</div>
                        </div>
                        
                        <div class="result-item">
                            <label class="result-label">Rémunération</label>
                            <div id="salary" class="result-value">Non spécifié</div>
                        </div>
                    </div>
                    
                    <div class="result-item full-width">
                        <label class="result-label">Compétences requises</label>
                        <div id="skills" class="result-value skills-container">Non spécifié</div>
                    </div>
                    
                    <div class="result-item full-width">
                        <label class="result-label">Responsabilités / Missions</label>
                        <div id="responsibilities" class="result-value">Non spécifié</div>
                    </div>
                    
                    <div class="result-item full-width">
                        <label class="result-label">Avantages</label>
                        <div id="benefits" class="result-value">Non spécifié</div>
                    </div>
                    
                    <div class="button-container">
                        <button type="button" id="exportBtn" class="btn btn-success">
                            <i class="fas fa-download"></i> Exporter les résultats
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <div id="notification" class="notification">
        <div class="notification-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="notification-content">
            <div class="notification-title">Succès</div>
            <div class="notification-message">Opération réussie</div>
        </div>
        <div class="notification-close">
            <i class="fas fa-times"></i>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Éléments DOM
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            const fileBadge = document.getElementById('fileBadge');
            const fileName = document.getElementById('fileName');
            const removeFile = document.getElementById('removeFile');
            const jobText = document.getElementById('jobText');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const analyzeTextBtn = document.getElementById('analyzeTextBtn');
            const loadingContainer = document.getElementById('loadingContainer');
            const resultContainer = document.getElementById('resultContainer');
            const exportBtn = document.getElementById('exportBtn');
            
            // Gestion du drag & drop
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropZone.classList.add('drag-active');
            }
            
            function unhighlight() {
                dropZone.classList.remove('drag-active');
            }
            
            // Gestion des événements de fichier
            dropZone.addEventListener('drop', handleDrop, false);
            fileInput.addEventListener('change', handleFileSelect, false);
            removeFile.addEventListener('click', handleFileRemove, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                if (files.length) {
                    handleFile(files[0]);
                }
            }
            
            function handleFileSelect(e) {
                if (fileInput.files.length) {
                    handleFile(fileInput.files[0]);
                }
            }
            
            function handleFile(file) {
                // Vérifier la taille du fichier (max 5MB)
                const maxSizeInBytes = 5 * 1024 * 1024;
                if (file.size > maxSizeInBytes) {
                    showNotification('Le fichier est trop volumineux. La taille maximale est de 5MB.', 'error');
                    return;
                }
                
                // Vérifier le type de fichier
                const acceptedTypes = [
                    'application/pdf',
                    'application/msword',
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                    'text/plain'
                ];
                
                if (!acceptedTypes.includes(file.type) && !file.name.match(/\.(pdf|docx?|txt)$/i)) {
                    showNotification('Format de fichier non supporté. Veuillez utiliser PDF, DOC, DOCX ou TXT.', 'error');
                    return;
                }
                
                // Afficher le badge de fichier
                fileName.textContent = file.name;
                fileBadge.style.display = 'flex';
                
                // Effacer le texte dans le textarea
                jobText.value = '';
                
                showNotification('Fichier sélectionné avec succès', 'success');
                
                // Mettre en évidence le bouton d'analyse
                analyzeBtn.classList.add('pulse');
                setTimeout(() => {
                    analyzeBtn.classList.remove('pulse');
                }, 2000);
            }
            
            function handleFileRemove(e) {
                e.stopPropagation();
                fileInput.value = '';
                fileBadge.style.display = 'none';
                showNotification('Fichier supprimé', 'info');
            }
            
            // Gestion des boutons d'analyse
            analyzeBtn.addEventListener('click', () => {
                if (fileInput.files.length === 0) {
                    showNotification('Veuillez d\'abord sélectionner un fichier', 'error');
                    return;
                }
                
                startAnalysis();
                
                // Lire le fichier
                const file = fileInput.files[0];
                readFileAsText(file)
                    .then(text => {
                        analyzeJobDescription(text);
                    })
                    .catch(error => {
                        console.error('Erreur lors de la lecture du fichier:', error);
                        showNotification('Erreur lors de la lecture du fichier', 'error');
                        stopAnalysis();
                    });
            });
            
            analyzeTextBtn.addEventListener('click', () => {
                const text = jobText.value.trim();
                
                if (text.length === 0) {
                    showNotification('Veuillez d\'abord saisir ou coller le texte de la fiche de poste', 'error');
                    return;
                }
                
                startAnalysis();
                analyzeJobDescription(text);
            });
            
            // Fonction pour analyser la fiche de poste
            function analyzeJobDescription(text) {
                // Simuler un délai d'analyse
                setTimeout(() => {
                    try {
                        // Analyse de base
                        const result = performLocalAnalysis(text);
                        
                        // Afficher les résultats
                        displayResults(result);
                        
                        // Terminer l'analyse
                        stopAnalysis();
                        showNotification('Analyse terminée avec succès', 'success');
                    } catch (error) {
                        console.error('Erreur lors de l\'analyse:', error);
                        showNotification('Erreur lors de l\'analyse: ' + error.message, 'error');
                        stopAnalysis();
                    }
                }, 1000);
            }
            
            // Fonction pour lire un fichier sous forme de texte
            function readFileAsText(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = () => {
                        resolve(reader.result);
                    };
                    
                    reader.onerror = () => {
                        reject(new Error('Erreur lors de la lecture du fichier'));
                    };
                    
                    reader.readAsText(file);
                });
            }
            
            // Démarrer l'analyse
            function startAnalysis() {
                loadingContainer.style.display = 'flex';
                resultContainer.style.display = 'none';
            }
            
            // Arrêter l'analyse
            function stopAnalysis() {
                loadingContainer.style.display = 'none';
            }
            
            // Afficher les résultats
            function displayResults(results) {
                // Titre du poste
                document.getElementById('jobTitle').textContent = results.title || 'Non spécifié';
                
                // Type de contrat
                document.getElementById('contractType').textContent = results.contract_type || 'Non spécifié';
                
                // Lieu
                document.getElementById('location').textContent = results.location || 'Non spécifié';
                
                // Expérience
                document.getElementById('experience').textContent = results.experience || 'Non spécifié';
                
                // Formation
                document.getElementById('education').textContent = results.education || 'Non spécifié';
                
                // Salaire
                document.getElementById('salary').textContent = results.salary || 'Non spécifié';
                
                // Compétences
                const skillsContainer = document.getElementById('skills');
                if (results.skills && Array.isArray(results.skills) && results.skills.length > 0) {
                    skillsContainer.innerHTML = results.skills
                        .map(skill => `<span class="tag">${skill}</span>`)
                        .join('');
                } else {
                    skillsContainer.textContent = 'Non spécifié';
                }
                
                // Responsabilités
                const responsibilitiesContainer = document.getElementById('responsibilities');
                if (results.responsibilities && Array.isArray(results.responsibilities) && results.responsibilities.length > 0) {
                    responsibilitiesContainer.innerHTML = '<ul>' + 
                        results.responsibilities.map(resp => `<li>${resp}</li>`).join('') + 
                        '</ul>';
                } else {
                    responsibilitiesContainer.textContent = 'Non spécifié';
                }
                
                // Avantages
                const benefitsContainer = document.getElementById('benefits');
                if (results.benefits && Array.isArray(results.benefits) && results.benefits.length > 0) {
                    benefitsContainer.innerHTML = '<ul>' + 
                        results.benefits.map(benefit => `<li>${benefit}</li>`).join('') + 
                        '</ul>';
                } else {
                    benefitsContainer.textContent = 'Non spécifié';
                }
                
                // Afficher le conteneur de résultats
                resultContainer.style.display = 'block';
                
                // Scroll jusqu'aux résultats
                resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            // Analyse locale simple
            function performLocalAnalysis(text) {
                console.log('Analyse locale du texte:', text.substring(0, 100) + '...');
                
                // Fonctions d'aide pour l'analyse
                function extractSection(text, sectionKeywords, nextSectionKeywords) {
                    let section = '';
                    const linesArray = text.split('\n');
                    
                    // Trouver le début de la section
                    let startIndex = -1;
                    for (let i = 0; i < linesArray.length; i++) {
                        const line = linesArray[i].toLowerCase();
                        if (sectionKeywords.some(keyword => line.includes(keyword))) {
                            startIndex = i + 1; // Commencer à la ligne suivante
                            break;
                        }
                    }
                    
                    if (startIndex === -1) return null;
                    
                    // Trouver la fin de la section
                    let endIndex = linesArray.length;
                    for (let i = startIndex; i < linesArray.length; i++) {
                        const line = linesArray[i].toLowerCase();
                        if (nextSectionKeywords.some(keyword => line.includes(keyword)) ||
                            line.match(/^[A-Z\s]{2,25}$/)) {
                            endIndex = i;
                            break;
                        }
                    }
                    
                    // Extraire la section
                    section = linesArray.slice(startIndex, endIndex).join('\n');
                    return section;
                }
                
                function extractList(text, prefix = '') {
                    const lines = text.split('\n');
                    const items = [];
                    
                    for (const line of lines) {
                        // Supprimer les puces et numéros
                        let trimmedLine = line.trim();
                        if (trimmedLine.match(/^[\s•\-*]\s+/) || 
                            trimmedLine.match(/^\d+\.\s+/) || 
                            trimmedLine.match(/^[a-z]\)\s+/i)) {
                            trimmedLine = trimmedLine.replace(/^[\s•\-*\d\.]+\s+/, '').replace(/^[a-z]\)\s+/i, '');
                            
                            if (trimmedLine && trimmedLine.length > 3) {
                                items.push(prefix + trimmedLine);
                            }
                        }
                    }
                    
                    return items;
                }
                
                function extractBulletPoints(text) {
                    if (!text) return [];
                    
                    const items = [];
                    const lines = text.split('\n');
                    
                    for (const line of lines) {
                        const trimmed = line.trim();
                        if (trimmed.length > 5 && !trimmed.endsWith(':')) {
                            items.push(trimmed);
                        }
                    }
                    
                    return items.slice(0, 10); // Limiter à 10 items
                }
                
                // Extraire le titre (première ligne non vide ou après "poste")
                let title = '';
                const titleRegex = /(?:poste|position|job title|titre|intitulé)[\s:]+([\w\s\-\/\(\)]+)/i;
                const titleMatch = text.match(titleRegex);
                
                if (titleMatch && titleMatch[1]) {
                    title = titleMatch[1].trim();
                } else {
                    // Prendre la première ligne non vide qui ressemble à un titre
                    const lines = text.split('\n').filter(line => line.trim());
                    for (const line of lines.slice(0, 5)) {
                        if (line.length < 100 && line.length > 3 && !line.includes(':')) {
                            title = line.trim();
                            break;
                        }
                    }
                }
                
                // Extraire le type de contrat
                let contractType = '';
                
                if (text.toLowerCase().includes('cdi')) {
                    contractType = 'CDI';
                } else if (text.toLowerCase().includes('cdd')) {
                    contractType = 'CDD';
                } else if (text.toLowerCase().includes('stage')) {
                    contractType = 'Stage';
                } else if (text.toLowerCase().includes('alternance') || 
                           text.toLowerCase().includes('apprentissage')) {
                    contractType = 'Alternance';
                } else if (text.toLowerCase().includes('freelance') || 
                           text.toLowerCase().includes('indépendant')) {
                    contractType = 'Freelance';
                } else if (text.toLowerCase().includes('temps partiel') || 
                           text.toLowerCase().includes('part-time')) {
                    contractType = 'Temps partiel';
                } else if (text.toLowerCase().includes('temps plein') || 
                           text.toLowerCase().includes('full-time')) {
                    contractType = 'Temps plein';
                } else {
                    contractType = 'CDI';
                }
                
                // Extraire le lieu
                let location = '';
                const locationRegex = /(?:lieu|location|localisation|ville|site|basé à)[\s:]+([\w\s\-\/\(\)]+)/i;
                const locationMatch = text.match(locationRegex);
                
                if (locationMatch && locationMatch[1]) {
                    location = locationMatch[1].trim();
                } else if (text.toLowerCase().includes('paris')) {
                    location = 'Paris';
                } else if (text.toLowerCase().includes('lyon')) {
                    location = 'Lyon';
                } else if (text.toLowerCase().includes('marseille')) {
                    location = 'Marseille';
                } else if (text.toLowerCase().includes('bordeaux')) {
                    location = 'Bordeaux';
                } else if (text.toLowerCase().includes('lille')) {
                    location = 'Lille';
                } else if (text.toLowerCase().includes('toulouse')) {
                    location = 'Toulouse';
                } else if (text.toLowerCase().includes('nice')) {
                    location = 'Nice';
                } else if (text.toLowerCase().includes('remote') || 
                           text.toLowerCase().includes('télétravail')) {
                    location = 'Télétravail';
                } else {
                    location = 'Paris';
                }
                
                // Extraire l'expérience requise
                let experience = '';
                const experienceRegex = /(?:expérience|experience|années)[\s:]+([\w\s\-\/\(\)]+)/i;
                const experienceMatch = text.match(experienceRegex);
                
                if (experienceMatch && experienceMatch[1]) {
                    experience = experienceMatch[1].trim();
                } else if (text.toLowerCase().includes('junior')) {
                    experience = 'Junior';
                } else if (text.toLowerCase().includes('confirmé')) {
                    experience = 'Confirmé (3-5 ans)';
                } else if (text.toLowerCase().includes('senior')) {
                    experience = 'Senior (5+ ans)';
                } else if (text.toLowerCase().includes('débutant')) {
                    experience = 'Débutant accepté';
                } else {
                    experience = '3-5 ans';
                }
                
                // Extraire la formation
                let education = '';
                const educationRegex = /(?:formation|diplôme|bac|master|études)[\s:]+([\w\s\-\/\(\)]+)/i;
                const educationMatch = text.match(educationRegex);
                
                if (educationMatch && educationMatch[1]) {
                    education = educationMatch[1].trim();
                } else if (text.toLowerCase().includes('bac+5')) {
                    education = 'Bac+5 ou équivalent';
                } else if (text.toLowerCase().includes('bac+3')) {
                    education = 'Bac+3 ou équivalent';
                } else if (text.toLowerCase().includes('ingénieur')) {
                    education = 'École d\'ingénieur';
                } else if (text.toLowerCase().includes('commerce')) {
                    education = 'École de commerce';
                } else {
                    education = 'Bac+5 ou équivalent';
                }
                
                // Extraire le salaire
                let salary = '';
                const salaryRegex = /(?:salaire|rémunération|package|salary)[\s:]+([\w\s\-\/\(\)\€\$\k]+)/i;
                const salaryMatch = text.match(salaryRegex);
                
                if (salaryMatch && salaryMatch[1]) {
                    salary = salaryMatch[1].trim();
                } else if (text.match(/\d+[kK]\€/)) {
                    const match = text.match(/(\d+)[kK]\€/);
                    salary = match[0];
                } else if (text.match(/\d+[kK]/)) {
                    const match = text.match(/(\d+)[kK]/);
                    salary = match[0] + '€';
                } else if (text.match(/\d+\s*[kK]\€/)) {
                    const match = text.match(/(\d+)\s*[kK]\€/);
                    salary = match[0];
                } else if (text.match(/\d+\s*-\s*\d+[kK]/)) {
                    const match = text.match(/(\d+)\s*-\s*(\d+)[kK]/);
                    salary = match[0] + '€';
                } else {
                    salary = 'Selon profil';
                }
                
                // Extraire les compétences requises
                let skillsText = extractSection(text, 
                    ['compétences', 'skills', 'profil', 'requis', 'requis'], 
                    ['mission', 'responsabilité', 'tâche', 'avantage', 'offre']);
                
                let skills = [];
                
                if (skillsText) {
                    skills = extractBulletPoints(skillsText);
                }
                
                // Si pas de compétences ou trop peu, ajouter quelques compétences techniques courantes
                if (skills.length < 3) {
                    const techSkills = [
                        'JavaScript', 'Java', 'Python', 'C#', 'C++', 'PHP', 'Ruby',
                        'React', 'Angular', 'Vue.js', 'Node.js', 'Django', 'Laravel',
                        'SQL', 'NoSQL', 'MongoDB', 'MySQL', 'PostgreSQL',
                        'AWS', 'Azure', 'GCP', 'Docker', 'Kubernetes',
                        'Git', 'Agile', 'Scrum', 'Jira'
                    ];
                    
                    const softSkills = [
                        'Communication', 'Travail en équipe', 'Autonomie', 'Rigueur',
                        'Organisation', 'Gestion de projet', 'Leadership', 'Adaptabilité',
                        'Résolution de problèmes', 'Esprit d\'analyse'
                    ];
                    
                    for (const skill of techSkills) {
                        if (text.toLowerCase().includes(skill.toLowerCase())) {
                            skills.push(skill);
                        }
                    }
                    
                    // Ajouter quelques compétences humaines si besoin
                    if (skills.length < 3) {
                        skills = skills.concat(softSkills.slice(0, 5 - skills.length));
                    }
                }
                
                skills = skills.slice(0, 10); // Limiter à 10 compétences
                
                // Extraire les responsabilités
                let responsibilitiesText = extractSection(text,
                    ['responsabilité', 'mission', 'tâche', 'poste consiste', 'rôle consiste', 'vous serez chargé'],
                    ['profil', 'compétence', 'requis', 'avantage', 'offre']);
                
                let responsibilities = [];
                
                if (responsibilitiesText) {
                    responsibilities = extractList(responsibilitiesText);
                }
                
                // Ajouter des responsabilités génériques si nécessaire
                if (responsibilities.length === 0) {
                    if (title.toLowerCase().includes('développeur') || 
                        title.toLowerCase().includes('ingénieur')) {
                        responsibilities = [
                            'Développer et maintenir des applications',
                            'Participer aux réunions d\'équipe et à la conception technique',
                            'Assurer la qualité du code et écrire des tests',
                            'Collaborer avec les autres équipes pour intégrer les fonctionnalités'
                        ];
                    } else if (title.toLowerCase().includes('chef') || 
                               title.toLowerCase().includes('manager') || 
                               title.toLowerCase().includes('directeur')) {
                        responsibilities = [
                            'Manager une équipe de professionnels',
                            'Définir la stratégie et les objectifs',
                            'Assurer le suivi des performances et des budgets',
                            'Représenter l\'équipe auprès des autres départements'
                        ];
                    } else {
                        responsibilities = [
                            'Participer aux projets de l\'entreprise',
                            'Collaborer avec les différentes équipes',
                            'Assurer le suivi et la qualité des livrables',
                            'Contribuer à l\'amélioration continue des processus'
                        ];
                    }
                }
                
                // Extraire les avantages
                let benefitsText = extractSection(text,
                    ['avantage', 'bénéfice', 'offer', 'nous offrons', 'nous proposons', 'package'],
                    ['process', 'candidature', 'postuler', 'contact']);
                
                let benefits = [];
                
                if (benefitsText) {
                    benefits = extractList(benefitsText);
                }
                
                // Ajouter quelques avantages génériques si nécessaire
                if (benefits.length === 0) {
                    benefits = [
                        'Tickets restaurant',
                        'Mutuelle d\'entreprise',
                        'Télétravail partiel',
                        'Ambiance de travail dynamique',
                        'Possibilités d\'évolution'
                    ];
                }
                
                // Résultat de l'analyse
                return {
                    title: title || 'Non spécifié',
                    contract_type: contractType || 'Non spécifié',
                    location: location || 'Non spécifié',
                    experience: experience || 'Non spécifié',
                    education: education || 'Non spécifié',
                    salary: salary || 'Non spécifié',
                    skills: skills.length > 0 ? skills : ['Non spécifié'],
                    responsibilities: responsibilities.length > 0 ? responsibilities : ['Non spécifié'],
                    benefits: benefits.length > 0 ? benefits : ['Non spécifié']
                };
            }
            
            // Exportation des résultats
            exportBtn.addEventListener('click', () => {
                // Recueillir les données
                const data = {
                    title: document.getElementById('jobTitle').textContent,
                    contract_type: document.getElementById('contractType').textContent,
                    location: document.getElementById('location').textContent,
                    experience: document.getElementById('experience').textContent,
                    education: document.getElementById('education').textContent,
                    salary: document.getElementById('salary').textContent,
                    skills: getSkillsArray(),
                    responsibilities: getResponsibilitiesArray(),
                    benefits: getBenefitsArray()
                };
                
                function getSkillsArray() {
                    const skillsContainer = document.getElementById('skills');
                    if (skillsContainer.textContent === 'Non spécifié') {
                        return ['Non spécifié'];
                    }
                    
                    const skills = [];
                    const tags = skillsContainer.querySelectorAll('.tag');
                    tags.forEach(tag => {
                        skills.push(tag.textContent);
                    });
                    
                    return skills;
                }
                
                function getResponsibilitiesArray() {
                    const responsibilitiesContainer = document.getElementById('responsibilities');
                    if (responsibilitiesContainer.textContent === 'Non spécifié') {
                        return ['Non spécifié'];
                    }
                    
                    const responsibilities = [];
                    const items = responsibilitiesContainer.querySelectorAll('li');
                    items.forEach(item => {
                        responsibilities.push(item.textContent);
                    });
                    
                    return responsibilities.length > 0 ? responsibilities : ['Non spécifié'];
                }
                
                function getBenefitsArray() {
                    const benefitsContainer = document.getElementById('benefits');
                    if (benefitsContainer.textContent === 'Non spécifié') {
                        return ['Non spécifié'];
                    }
                    
                    const benefits = [];
                    const items = benefitsContainer.querySelectorAll('li');
                    items.forEach(item => {
                        benefits.push(item.textContent);
                    });
                    
                    return benefits.length > 0 ? benefits : ['Non spécifié'];
                }
                
                // Convertir en JSON
                const jsonData = JSON.stringify(data, null, 2);
                
                // Créer un blob
                const blob = new Blob([jsonData], { type: 'application/json' });
                
                // Créer une URL pour le téléchargement
                const url = URL.createObjectURL(blob);
                
                // Créer un lien de téléchargement
                const a = document.createElement('a');
                a.href = url;
                a.download = 'fiche_de_poste_' + new Date().toISOString().split('T')[0] + '.json';
                document.body.appendChild(a);
                a.click();
                
                // Nettoyer
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 0);
                
                showNotification('Données exportées avec succès', 'success');
            });
            
            // Système de notification
            function showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                const notificationIcon = notification.querySelector('.notification-icon i');
                const notificationTitle = notification.querySelector('.notification-title');
                const notificationMessage = notification.querySelector('.notification-message');
                
                // Réinitialiser les classes
                notification.className = 'notification';
                notification.classList.add(type);
                
                // Définir le titre et l'icône
                notificationIcon.className = '';
                if (type === 'success') {
                    notificationTitle.textContent = 'Succès';
                    notificationIcon.className = 'fas fa-check-circle';
                } else if (type === 'error') {
                    notificationTitle.textContent = 'Erreur';
                    notificationIcon.className = 'fas fa-exclamation-circle';
                } else if (type === 'info') {
                    notificationTitle.textContent = 'Information';
                    notificationIcon.className = 'fas fa-info-circle';
                }
                
                // Définir le message
                notificationMessage.textContent = message;
                
                // Afficher la notification
                notification.classList.add('show');
                
                // Masquer la notification après 5 secondes
                const timeout = setTimeout(() => {
                    hideNotification();
                }, 5000);
                
                // Permettre de fermer la notification manuellement
                const closeButton = notification.querySelector('.notification-close');
                closeButton.addEventListener('click', () => {
                    clearTimeout(timeout);
                    hideNotification();
                });
                
                function hideNotification() {
                    notification.classList.remove('show');
                }
            }
        });
    </script>
</body>
</html>
