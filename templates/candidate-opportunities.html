<!DOCTYPE html>
<html lang="fr">
<!-- ... le reste du code HTML reste identique ... -->
<script>
    // 1. Fonction pour charger et afficher les opportunités sélectionnées
    function loadSavedOpportunities() {
        // Récupérer le conteneur où afficher les opportunités
        const opportunitiesContainer = document.getElementById('selected-opportunities');
        
        // Si le conteneur n'existe pas, arrêter l'exécution
        if (!opportunitiesContainer) {
            console.error("Conteneur des opportunités non trouvé");
            return;
        }
        
        // MODIFICATION ICI - Utiliser la clé 'selectedOpportunities' au lieu de 'savedOpportunities'
        const savedJobs = JSON.parse(localStorage.getItem('selectedOpportunities') || '[]');
        
        // Vérifier s'il y a des opportunités à afficher
        if (savedJobs.length === 0) {
            opportunitiesContainer.innerHTML = `
                <div class="no-opportunities-message">
                    <h3><i class="fas fa-info-circle"></i> Aucune opportunité sélectionnée</h3>
                    <p>Vous n'avez pas encore sélectionné d'opportunités. Découvrez notre sélection de postes adaptés à votre profil.</p>
                    <a href="candidate-matching-improved.html" class="discover-btn">
                        <i class="fas fa-search"></i> Découvrir des opportunités
                    </a>
                </div>
            `;
            return;
        }
        
        // Afficher chaque opportunité sauvegardée
        let opportunitiesHTML = '';
        
        savedJobs.forEach((job, index) => {
            const matchPercentage = job.matchPercentage ? job.matchPercentage : '85%';
            const matchValue = parseInt(matchPercentage);
            const matchClass = matchValue >= 80 ? 'match-high' : 
                          matchValue >= 60 ? 'match-medium' : 'match-low';
                          
            // Créer une représentation visuelle de la timeline du processus (simplifiée)
            const stages = [
                { name: "En cours de validation", status: "completed" },
                { name: "Call prise de contact", status: "active" },
                { name: "Entretien visio", status: "" },
                { name: "Entretien Présentiel", status: "" },
                { name: "Acceptation", status: "" }
            ];
            
            let stagesHTML = '';
            let progressWidth = 20; // Progression par défaut (première étape)
            
            stages.forEach((stage, i) => {
                const stageStatus = i === 0 ? "completed" : (i === 1 ? "active" : "");
                const stageIcon = stageStatus === "completed" ? 
                                `<i class="fas fa-check"></i>` : 
                                (stageStatus === "active" ? 
                                `<i class="fas fa-circle"></i>` : 
                                `<i class="far fa-circle"></i>`);
                
                stagesHTML += `
                    <div class="stage ${stageStatus}">
                        <div class="stage-icon">
                            ${stageIcon}
                        </div>
                        <div class="stage-label">${stage.name}</div>
                        ${stageStatus === "active" ? `
                        <div class="interviewer-card">
                            <div class="interviewer-name">Recruteur ${index + 1}</div>
                            <div class="interviewer-title">Responsable Recrutement</div>
                            <div class="interview-date">
                                <i class="fas fa-calendar-alt"></i> Prochainement
                            </div>
                        </div>` : ''}
                    </div>
                `;
            });
            
            opportunitiesHTML += `
                <div class="opportunity-card" data-status="in-progress" data-job-id="${job.id}">
                    <div class="opportunity-header">
                        <div class="opportunity-company">
                            <div class="logo-placeholder">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="company-details">
                                <h3 class="company-name">${job.company}</h3>
                                <h4 class="job-title">${job.title}</h4>
                                <p class="job-info"><i class="fas fa-money-bill-wave"></i> ${job.salary}</p>
                                <a href="candidate-resources.html?email=demo.utilisateur%40nexten.fr&password=s" class="resource-button">
                                    Accéder aux ressources
                                </a>
                            </div>
                        </div>
                        <div class="opportunity-match">
                            <span class="match-percentage">${matchPercentage}</span>
                            <span class="match-label">Match</span>
                        </div>
                    </div>
                    
                    <div class="opportunity-status">
                        <div class="status-info">
                            <span class="status-label"><i class="fas fa-info-circle"></i> Statut: <strong>En traitement</strong></span>
                            <span class="travel-time"><i class="fas fa-map-marker-alt"></i> Temps de trajet: <a href="#" class="map-link">${job.location} <span class="text-nowrap">(voir sur Maps)</span></a></span>
                        </div>
                        
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${progressWidth}%;"></div>
                        </div>
                    </div>
                    
                    <div class="recruitment-stages">
                        <div class="stages-line"></div>
                        <div class="stages-progress" style="width: ${progressWidth}%;"></div>
                        
                        <div class="stages-wrapper">
                            ${stagesHTML}
                        </div>
                    </div>
                    
                    <div class="opportunity-actions">
                        <div class="primary-actions">
                            <button class="btn btn-primary"><i class="fas fa-comment-dots"></i> Poser une question</button>
                            <button class="btn btn-outline-danger remove-job" data-job-id="${job.id}"><i class="fas fa-times-circle"></i> Retirer cette opportunité</button>
                            <button class="btn btn-outline"><i class="fas fa-calendar-alt"></i> Définir un rappel</button>
                        </div>
                        <div class="secondary-actions">
                            <button class="btn btn-outline btn-icon-text"><i class="fas fa-envelope"></i> Messagerie</button>
                            <div class="notes-container">
                                <span>Note personnelle: </span>
                                <div class="note-input-container">
                                    <input type="text" class="form-control" placeholder="Ajouter un rappel...">
                                    <button class="btn-save" aria-label="Sauvegarder la note"><i class="fas fa-bell"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        
        // Insérer le HTML dans le conteneur
        opportunitiesContainer.innerHTML = opportunitiesHTML;
        
        // Ajouter les écouteurs d'événements pour les boutons
        initRemoveButtons();
    }

    // MODIFICATION ICI - Mise à jour de la fonction de suppression
    function removeJob(jobId) {
        // Récupérer les opportunités sauvegardées
        let savedJobs = JSON.parse(localStorage.getItem('selectedOpportunities') || '[]');
        
        // Filtrer pour retirer l'opportunité spécifiée
        const updatedJobs = savedJobs.filter(job => job.id !== jobId);
        
        // Sauvegarder la nouvelle liste
        localStorage.setItem('selectedOpportunities', JSON.stringify(updatedJobs));
        
        // Afficher une notification
        showNotification('Opportunité retirée de vos sélections');
        
        // Mettre à jour l'affichage
        loadSavedOpportunities();
    }
    
    // Le reste du code reste identique...
</script>
</body>
</html>